
Architecture
Observability
Logs
Settings



1




Activity

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment restarted

37 seconds ago

CarolineMinelli

Deployment successful

2 minutes ago


New environment

devjohnnydev

Â·
2 minutes ago

CarolineMinelli
Deployments
Variables
Metrics
Settings
Unexposed service
us-east4-eqdc4a
1 Replica


CarolineMinelli
/
c977272d
Crashed

Jan 8, 2026, 10:46 PM
Get Help
Details
Build Logs
Deploy Logs
Filter and search logs

You reached the start of the range
Jan 8, 2026, 10:46 PM
Starting Container
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};kr.create=t=>{var e;return new kr({checks:[],typeName:I.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};var Er=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.boolean,received:n.parsedType}),R}return Le(e.data)}};Er.create=t=>new Er({typeName:I.ZodBoolean,coerce:t?.coerce||!1,...F(t)});var Tr=class t extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.date,received:a.parsedType}),R}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_date}),R}let n=new Ne,i;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Q.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Tr.create=t=>new Tr({checks:[],coerce:t?.coerce||!1,typeName:I.ZodDate,...F(t)});var Fn=class extends B{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.symbol,received:n.parsedType}),R}return Le(e.data)}};Fn.create=t=>new Fn({typeName:I.ZodSymbol,...F(t)});var Cr=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.undefined,received:n.parsedType}),R}return Le(e.data)}};Cr.create=t=>new Cr({typeName:I.ZodUndefined,...F(t)});var Ar=class extends B{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.null,received:n.parsedType}),R}return Le(e.data)}};Ar.create=t=>new Ar({typeName:I.ZodNull,...F(t)});var er=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};er.create=t=>new er({typeName:I.ZodAny,...F(t)});var Dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};Dt.create=t=>new Dt({typeName:I.ZodUnknown,...F(t)});var ht=class extends B{_parse(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.never,received:r.parsedType}),R}};ht.create=t=>new ht({typeName:I.ZodNever,...F(t)});var Bn=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.void,received:n.parsedType}),R}return Le(e.data)}};Bn.create=t=>new Bn({typeName:I.ZodVoid,...F(t)});var Mt=class t extends B{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==C.array)return E(r,{code:w.invalid_type,expected:C.array,received:r.parsedType}),R;if(i.exactLength!==null){let s=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(s||o)&&(E(r,{code:s?w.too_big:w.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(E(r,{code:w.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(E(r,{code:w.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,o)=>i.type._parseAsync(new ut(r,s,r.path,o)))).then(s=>Ne.mergeArray(n,s));let a=[...r.data].map((s,o)=>i.type._parseSync(new ut(r,s,r.path,o)));return Ne.mergeArray(n,a)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};Mt.create=(t,e)=>new Mt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...F(e)});function Rn(t){if(t instanceof We){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=ct.create(Rn(n))}return new We({...t._def,shape:()=>e})}else return t instanceof Mt?new Mt({...t._def,type:Rn(t.element)}):t instanceof ct?ct.create(Rn(t.unwrap())):t instanceof Ct?Ct.create(Rn(t.unwrap())):t instanceof Tt?Tt.create(t.items.map(e=>Rn(e))):t}var We=class t extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Q.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==C.object){let c=this._getOrReturnCtx(e);return E(c,{code:w.invalid_type,expected:C.object,received:c.parsedType}),R}let{status:n,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(let c in i.data)s.includes(c)||o.push(c);let u=[];for(let c of s){let l=a[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ut(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ht){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(E(i,{code:w.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let p=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ut(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let p=await l.key,d=await l.value;c.push({key:p,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,a,s,o;let u=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,r,n).message)!==null&&s!==void 0?s:n.defaultError;return r.code==="unrecognized_keys"?{message:(o=N.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return Q.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Rn(this)}partial(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ct;)a=a._def.innerType;r[n]=a}}),new t({...this._def,shape:()=>r})}keyof(){return Sw(Q.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});var Pr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let s=a.map(o=>new et(o.ctx.common.issues));return E(r,{code:w.invalid_union,unionErrors:s}),R}if(r.common.async)return Promise.all(n.map(async a=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(i);{let a,s=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},l=u._parseSync({data:r.data,path:r.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;let o=s.map(u=>new et(u));return E(r,{code:w.invalid_union,unionErrors:o}),R}}get options(){return this._def.options}};Pr.create=(t,e)=>new Pr({options:t,typeName:I.ZodUnion,...F(e)});var It=t=>t instanceof Nr?It(t.schema):t instanceof tt?It(t.innerType()):t instanceof Or?[t.value]:t instanceof jr?t.options:t instanceof Ir?Q.objectValues(t.enum):t instanceof Rr?It(t._def.innerType):t instanceof Cr?[void 0]:t instanceof Ar?[null]:t instanceof ct?[void 0,...It(t.unwrap())]:t instanceof Ct?[null,...It(t.unwrap())]:t instanceof ha||t instanceof Mr?It(t.unwrap()):t instanceof Dr?It(t._def.innerType):[],So=class t extends B{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return E(r,{code:w.invalid_type,expected:C.object,received:r.parsedType}),R;let n=this.discriminator,i=r.data[n],a=this.optionsMap.get(i);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let a of r){let s=It(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new t({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...F(n)})}};function Id(t,e){let r=Rt(t),n=Rt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let i=Q.objectKeys(e),a=Q.objectKeys(t).filter(o=>i.indexOf(o)!==-1),s={...t,...e};for(let o of a){let u=Id(t[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let a=0;a<t.length;a++){let s=t[a],o=e[a],u=Id(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var qr=class extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(a,s)=>{if(Od(a)||Od(s))return R;let o=Id(a.value,s.value);return o.valid?((jd(a)||jd(s))&&r.dirty(),{status:r.value,value:o.data}):(E(n,{code:w.invalid_intersection_types}),R)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};qr.create=(t,e,r)=>new qr({left:t,right:e,typeName:I.ZodIntersection,...F(r)});var Tt=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return E(n,{code:w.invalid_type,expected:C.array,received:n.parsedType}),R;if(n.data.length<this._def.items.length)return E(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let a=[...n.data].map((s,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ut(n,s,n.path,o)):null}).filter(s=>!!s);return n.common.async?Promise.all(a).then(s=>Ne.mergeArray(r,s)):Ne.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Tt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tt({items:t,typeName:I.ZodTuple,rest:null,...F(e)})};var _o=class t extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return E(n,{code:w.invalid_type,expected:C.object,received:n.parsedType}),R;let i=[],a=this._def.keyType,s=this._def.valueType;for(let o in n.data)i.push({key:a._parse(new ut(n,o,n.path,o)),value:s._parse(new ut(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(r,i):Ne.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof B?new t({keyType:e,valueType:r,typeName:I.ZodRecord,...F(n)}):new t({keyType:Yt.create(),valueType:e,typeName:I.ZodRecord,...F(r)})}},Ln=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return E(n,{code:w.invalid_type,expected:C.map,received:n.parsedType}),R;let i=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map(([o,u],c)=>({key:i._parse(new ut(n,o,n.path,[c,"key"])),value:a._parse(new ut(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of s){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let u of s){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}}}};Ln.create=(t,e,r)=>new Ln({valueType:e,keyType:t,typeName:I.ZodMap,...F(r)});var zn=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return E(n,{code:w.invalid_type,expected:C.set,received:n.parsedType}),R;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(E(n,{code:w.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(E(n,{code:w.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let a=this._def.valueType;function s(u){let c=new Set;for(let l of u){if(l.status==="aborted")return R;l.status==="dirty"&&r.dirty(),c.add(l.value)}return{status:r.value,value:c}}let o=[...n.data.values()].map((u,c)=>a._parse(new ut(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};zn.create=(t,e)=>new zn({valueType:t,minSize:null,maxSize:null,typeName:I.ZodSet,...F(e)});var ko=class t extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return E(r,{code:w.invalid_type,expected:C.function,received:r.parsedType}),R;function n(o,u){return bo({data:o,path:r.path,errorMaps:[r.comm
on.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:u}})}function i(o,u){return bo({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:u}})}let a={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof tr){let o=this;return Le(async function(...u){let c=new et([]),l=await o._def.args.parseAsync(u,a).catch(m=>{throw c.addIssue(n(u,m)),c}),p=await Reflect.apply(s,this,l);return await o._def.returns._def.type.parseAsync(p,a).catch(m=>{throw c.addIssue(i(p,m)),c})})}else{let o=this;return Le(function(...u){let c=o._def.args.safeParse(u,a);if(!c.success)throw new et([n(u,c.error)]);let l=Reflect.apply(s,this,c.data),p=o._def.returns.safeParse(l,a);if(!p.success)throw new et([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Tt.create(e).rest(Dt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Tt.create([]).rest(Dt.create()),returns:r||Dt.create(),typeName:I.ZodFunction,...F(n)})}},Nr=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Nr.create=(t,e)=>new Nr({getter:t,typeName:I.ZodLazy,...F(e)});var Or=class extends B{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return E(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}};Or.create=(t,e)=>new Or({value:t,typeName:I.ZodLiteral,...F(e)});function Sw(t,e){return new jr({values:t,typeName:I.ZodEnum,...F(e)})}var jr=class t extends B{constructor(){super(...arguments),da.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{expected:Q.joinValues(n),received:r.parsedType,code:w.invalid_type}),R}if(wo(this,da,"f")||yw(this,da,new Set(this._def.values),"f"),!wo(this,da,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{received:r.data,code:w.invalid_enum_value,options:n}),R}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};da=new WeakMap;jr.create=Sw;var Ir=class extends B{constructor(){super(...arguments),fa.set(this,void 0)}_parse(e){let r=Q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let i=Q.objectValues(r);return E(n,{expected:Q.joinValues(i),received:n.parsedType,code:w.invalid_type}),R}if(wo(this,fa,"f")||yw(this,fa,new Set(Q.getValidEnumValues(this._def.values)),"f"),!wo(this,fa,"f").has(e.data)){let i=Q.objectValues(r);return E(n,{received:n.data,code:w.invalid_enum_value,options:i}),R}return Le(e.data)}get enum(){return this._def.values}};fa=new WeakMap;Ir.create=(t,e)=>new Ir({values:t,typeName:I.ZodNativeEnum,...F(e)});var tr=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return E(r,{code:w.invalid_type,expected:C.promise,received:r.parsedType}),R;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return Le(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};tr.create=(t,e)=>new tr({type:t,typeName:I.ZodPromise,...F(e)});var tt=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{E(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){let s=i.transform(n.data,a);if(n.common.async)return Promise.resolve(s).then(async o=>{if(r.value==="aborted")return R;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?R:u.status==="dirty"||r.value==="dirty"?Dn(u.value):u});{if(r.value==="aborted")return R;let o=this._def.schema._parseSync({data:s,path:n.path,parent:n});return o.status==="aborted"?R:o.status==="dirty"||r.value==="dirty"?Dn(o.value):o}}if(i.type==="refinement"){let s=o=>{let u=i.refinement(o,a);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Sr(s))return s;let o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Sr(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:r.value,value:o})):s);Q.assertNever(i)}};tt.create=(t,e,r)=>new tt({schema:t,typeName:I.ZodEffects,effect:e,...F(r)});tt.createWithPreprocess=(t,e,r)=>new tt({schema:e,effect:{type:"preprocess",transform:t},typeName:I.ZodEffects,...F(r)});var ct=class extends B{_parse(e){return this._getType(e)===C.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:I.ZodOptional,...F(e)});var Ct=class extends B{_parse(e){return this._getType(e)===C.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ct.create=(t,e)=>new Ct({innerType:t,typeName:I.ZodNullable,...F(e)});var Rr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...F(e)});var Dr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ma(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Dr.create=(t,e)=>new Dr({innerType:t,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...F(e)});var $n=class extends B{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.nan,received:n.parsedType}),R}return{status:"valid",value:e.data}}};$n.create=t=>new $n({typeName:I.ZodNaN,...F(t)});var hP=Symbol("zod_brand"),ha=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},va=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?R:a.status==="dirty"?(r.dirty(),Dn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?R:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:I.ZodPipeline})}},Mr=class extends B{_parse(e){let r=this._def.innerType._parse(e),n=i=>(Sr(i)&&(i.value=Object.freeze(i.value)),i);return ma(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:I.ZodReadonly,...F(e)});function hw(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function _w(t,e={},r){return t?er.create().superRefine((n,i)=>{var a,s;let o=t(n);if(o instanceof Promise)return o.then(u=>{var c,l;if(!u){let p=hw(e,n),d=(l=(c=p.fatal)!==null&&c!==void 0?c:r)!==null&&l!==void 0?l:!0;i.addIssue({code:"custom",...p,fatal:d})}});if(!o){let u=hw(e,n),c=(s=(a=u.fatal)!==null&&a!==void 0?a:r)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...u,fatal:c})}}):er.create()}var vP={object:We.lazycreate},I;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(I||(I={}));var gP=(t,e={message:`Input not instance of ${t.name}`})=>_w(r=>r instanceof t,e),kw=Yt.create,Ew=_r.create,yP=$n.create,xP=kr.create,Tw=Er.create,bP=Tr.create,wP=Fn.create,SP=Cr.create,_P=Ar.create,kP=er.create,EP=Dt.create,TP=ht.create,CP=Bn.create,AP=Mt.create,PP=We.create,qP=We.strictCreate,NP=Pr.create,OP=So.create,jP=qr.create,IP=Tt.create,RP=_o.create,DP=Ln.create,MP=zn.create,FP=ko.create,BP=Nr.create,LP=Or.create,zP=jr.create,$P=Ir.create,UP=tr.create,vw=tt.create,QP=ct.create,VP=Ct.create,HP=tt.createWithPreprocess,GP=va.create,KP=()=>kw().optional(),ZP=()=>Ew().optional(),WP=()=>Tw().optional(),XP={string:(t=>Yt.create({...t,coerce:!0})),number:(t=>_r.create({...t,coerce:!0})),boolean:(t=>Er.create({...t,coerce:!0})),bigint:(t=>kr.create({...t,coerce:!0})),date:(t=>Tr.create({...t,coerce:!0}))},JP=R,ye=Object.freeze({__proto__:null,defaultErrorMap:Mn,setErrorMap:H9,getErrorMap:xo,makeIssue:bo,EMPTY_PATH:G9,addIssueToContext:E,ParseStatus:Ne,INVALID:R,DIRTY:Dn,OK:Le,isAborted:Od,isDirty:jd,isValid:Sr,isAsync:ma,get util(){return Q},get objectUtil(){return Nd},ZodParsedType:C,getParsedType:Rt,ZodType:B,datetimeRegex:ww,ZodString:Yt,ZodNumber:_r,ZodBigInt:kr,ZodBoolean:Er,ZodDate:Tr,ZodSymbol:Fn,ZodUndefined:Cr,ZodNull:Ar,ZodAny:er,ZodUnknown:Dt,ZodNever:ht,ZodVoid:Bn,ZodArray:Mt,ZodObject:We,ZodUnion:Pr,ZodDiscriminatedUnion:So,ZodIntersection:qr,ZodTuple:Tt,ZodRecord:_o,ZodMap:Ln,ZodSet:zn,ZodFunction:ko,ZodLazy:Nr,ZodLiteral:Or,ZodEnum:jr,ZodNativeEnum:Ir,ZodPromise:tr,ZodEffects:tt,ZodTransformer:tt,ZodOptional:ct,ZodNullable:Ct,ZodDefault:Rr,ZodCatch:Dr,ZodNaN:$n,BRAND:hP,ZodBranded:ha,ZodPipeline:va,ZodReadonly:Mr,custom:_w,Schema:B,ZodSchema:B,late:vP,get ZodFirstPartyTypeKind(){return I},coerce:XP,any:kP,array:AP,bigint:xP,boolean:Tw,date:bP,discriminatedUnion:OP,effect:vw,enum:zP,function:FP,instanceof:gP,intersection:jP,lazy:BP,literal:LP,map:DP,nan:yP,nativeEnum:$P,never:TP,null:_P,nullable:VP,number:Ew,object:PP,oboolean:WP,onumber:ZP,optional:QP,ostring:KP,pipeline:GP,preprocess:HP,promise:UP,record:RP,set:MP,strictObject:qP,string:kw,symbol:wP,transformer:vw,tuple:IP,undefined:SP,union:NP,unknown:EP,void:CP,NEVER:JP,ZodIssueCode:w,quotelessJson:V9,ZodError:et});var ce={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function fe(t,e){return e.includes(t.columnType)}function YP(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var eq=ye.union([ye.string(),ye.number(),ye.boolean(),ye.null()]),tq=ye.union([eq,ye.record(ye.any()),ye.array(ye.any())]),rq=ye.custom(t=>t instanceof Buffer);function Cw(t,e){let r=e?.zodInstance??ye,n=e?.coerce??{},i;return YP(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(fe(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):fe(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):fe(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):fe(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):fe(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):fe(t,["PgArray"])?(i=r.array(Cw(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=nq(t,r,n):t.dataType==="bigint"?i=iq(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=aq(t,r,n):t.dataType==="json"?i=tq:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=rq)),i||(i=r.any()),i}function nq(t,e,r){let n=t.getSQLType().includes("unsigned"),i,a,s=!1;fe(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:ce.INT8_MIN,a=n?ce.INT8_UNSIGNED_MAX:ce.INT8_MAX,s=!0):fe(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:ce.INT16_MIN,a=n?ce.INT16_UNSIGNED_MAX:ce.INT16_MAX,s=!0):fe(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:ce.INT24_MIN,a=n?ce.INT24_UNSIGNED_MAX:ce.INT24_MAX,s=fe(t,["MySqlMediumInt","SingleStoreMediumInt"])):fe(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:ce.INT32_MIN,a=n?ce.INT32_UNSIGNED_MAX:ce.INT32_MAX,s=!0):fe(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:ce.INT48_MIN,a=n?ce.INT48_UNSIGNED_MAX:ce.INT48_MAX):fe(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||fe(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=!0):fe(t,["MySqlYear","SingleStoreYear"])?(i=1901,a=2155,s=!0):(i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(a),s?o.int():o}function iq(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:ce.INT64_MIN,a=n?ce.INT64_UNSIGNED_MAX:ce.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(a)}function aq(t,e,r){if(fe(t,["PgUUID"]))return e.string().uuid();let n,i,a=!1;fe(t,["PgVarchar","SQLiteText"])?n=t.length:fe(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??ce.INT16_UNSIGNED_MAX:fe(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=ce.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=ce.INT24_UNSIGNED_MAX:t.textType==="text"?n=ce.INT16_UNSIGNED_MAX:n=ce.INT8_UNSIGNED_MAX),fe(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,a=!0),fe(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let s=r===!0||r?.string?e.coerce.string():e.string();return s=i?s.regex(i):s,n&&a?s.length(n):n?s.max(n):s}function Aw(t){return tp(t)?Xs(t):a1(t)}function Pw(t,e,r,n){let i={};for(let[a,s]of Object.entries(t)){if(!x(s,H)&&!x(s,A)&&!x(s,A.Aliased)&&typeof s=="object"){let p=tp(s)||t1(s)?Aw(s):s;i[a]=Pw(p,e[a]??{},r,n);continue}let o=e[a];if(o!==void 0&&typeof o!="function"){i[a]=o;continue}let u=x(s,H)?s:void 0,c=u?Cw(u,n):ye.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[a]=l,u&&(r.nullable(u)&&(i[a]=i[a].nullable()),r.optional(u)&&(i[a]=i[a].optional())))}return ye.object(i)}var sq={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var qw=(t,e)=>{let r=Aw(t);return Pw(r,e??{},sq)};var ga=L1("services",{id:eo("id").primaryKey(),title:wr("title").notNull(),description:wr("description").notNull(),category:wr("category").notNull(),icon:wr("icon").notNull()}),oq=qw(ga).omit({id:!0});var{Pool:cq}=Wt;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var uq=new cq({connectionString:process.env.DATABASE_URL}),Dd=yo(uq,{schema:Rd});var Md=class{async getServices(){return await Dd.select().from(ga)}async createService(e){let[r]=await Dd.insert(ga).values(e).returning();return r}},Eo=new Md;var MB={internal:ye.object({message:ye.string()})},Nw={services:{list:{method:"GET",path:"/api/services",responses:{200:ye.array(ye.custom())}}}};async function lq(){if((await Eo.getServices()).length===0){let e=[{title:"Guarda",description:"Prote\xE7\xE3o e bem-estar dos filhos e menores.",category:"Fam\xEDlia",icon:"Shield"},{title:"Investiga\xE7\xE3o de Paternidade",description:"Reconhecimento biol\xF3gico e garantia de direitos.",category:"Fam\xEDlia",icon:"Search"},{title:"Div\xF3rcio",description:"Atua\xE7\xE3o em div\xF3rcios judiciais e extrajudiciais.",category:"Fam\xEDlia",icon:"HeartCrack"},{title:"Regulariza\xE7\xE3o de Im\xF3vel",description:"Regulariza\xE7\xE3o documental e usucapi\xE3o.",category:"Civil",icon:"Home"},{title:"Indeniza\xE7\xE3o",description:"A\xE7\xF5es de repara\xE7\xE3o por danos materiais e morais.",category:"Civil",icon:"Gavel"},{title:"Direito do Consumidor",description:"Defesa contra pr\xE1ticas abusivas e defeitos.",category:"Civil",icon:"ShoppingBag"},{title:"Consultoria C\xEDvel",description:"Orienta\xE7\xE3o preventiva e an\xE1lise de riscos.",category:"Civil",icon:"BookOpen"},{title:"Acordos Extrajudiciais",description:"Resolu\xE7\xE3o de conflitos de forma amig\xE1vel.",category:"Civil",icon:"Handshake"},{title:"Planejamento Patrimonial",description:"Organiza\xE7\xE3o e prote\xE7\xE3o de bens e heran\xE7a.",category:"Civil",icon:"Briefcase"}];for(let r of e)await Eo.createService(r);console.log("Database seeded with services.")}}async function Ow(t,e){return await lq(),e.get(Nw.services.list.path,async(r,n)=>{let i=await Eo.getServices();n.json(i)}),t}var jw=Qn(Mu(),1),Iw=Qn(require("fs"),1),Fd=Qn(require("path"),1);function Rw(t){let e=Fd.default.resolve(__dirname,"public");if(!Iw.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);t.use(jw.default.static(e)),t.use("*",(r,n)=>{n.sendFile(Fd.default.resolve(e,"index.html"))})}var Mw=require("http"),Fr=(0,To.default)(),Dw=(0,Mw.createServer)(Fr);Fr.use(To.default.json({verify:(t,e,r)=>{t.rawBody=r}}));Fr.use(To.default.urlencoded({extended:!1}));function Bd(t,e="express"){let r=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${r} [${e}] ${t}`)}Fr.use((t,e,r)=>{let n=Date.now(),i=t.path,a,s=e.json;e.json=function(o,...u){return a=o,s.apply(e,[o,...u])},e.on("finish",()=>{let o=Date.now()-n;if(i.startsWith("/api")){let u=`${t.method} ${i} ${e.statusCode} in ${o}ms`;a&&(u+=` :: ${JSON.stringify(a)}`),Bd(u)}}),r()});(async()=>{await Ow(Dw,Fr),Fr.use((e,r,n,i)=>{let a=e.status||e.statusCode||500,s=e.message||"Internal Server Error";throw n.status(a).json({message:s}),e}),Rw(Fr);let t=parseInt(process.env.PORT||"5000",10);Dw.listen({port:t,host:"0.0.0.0",reusePort:!0},()=>{Bd(`serving on port ${t}`)})})();0&&(module.exports={log});
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/app/dist/index.cjs:70:99269)
    at Module._compile (node:internal/modules/cjs/loader:1706:14)
    at Object..js (node:internal/modules/cjs/loader:1839:10)
    at Module.load (node:internal/modules/cjs/loader:1441:32)
    at Function._load (node:internal/modules/cjs/loader:1263:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.21.1
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};kr.create=t=>{var e;return new kr({checks:[],typeName:I.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};var Er=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.boolean,received:n.parsedType}),R}return Le(e.data)}};Er.create=t=>new Er({typeName:I.ZodBoolean,coerce:t?.coerce||!1,...F(t)});var Tr=class t extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.date,received:a.parsedType}),R}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_date}),R}let n=new Ne,i;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Q.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Tr.create=t=>new Tr({checks:[],coerce:t?.coerce||!1,typeName:I.ZodDate,...F(t)});var Fn=class extends B{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.symbol,received:n.parsedType}),R}return Le(e.data)}};Fn.create=t=>new Fn({typeName:I.ZodSymbol,...F(t)});var Cr=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.undefined,received:n.parsedType}),R}return Le(e.data)}};Cr.create=t=>new Cr({typeName:I.ZodUndefined,...F(t)});var Ar=class extends B{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.null,received:n.parsedType}),R}return Le(e.data)}};Ar.create=t=>new Ar({typeName:I.ZodNull,...F(t)});var er=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};er.create=t=>new er({typeName:I.ZodAny,...F(t)});var Dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};Dt.create=t=>new Dt({typeName:I.ZodUnknown,...F(t)});var ht=class extends B{_parse(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.never,received:r.parsedType}),R}};ht.create=t=>new ht({typeName:I.ZodNever,...F(t)});var Bn=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.void,received:n.parsedType}),R}return Le(e.data)}};Bn.create=t=>new Bn({typeName:I.ZodVoid,...F(t)});var Mt=class t extends B{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==C.array)return E(r,{code:w.invalid_type,expected:C.array,received:r.parsedType}),R;if(i.exactLength!==null){let s=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(s||o)&&(E(r,{code:s?w.too_big:w.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(E(r,{code:w.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(E(r,{code:w.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,o)=>i.type._parseAsync(new ut(r,s,r.path,o)))).then(s=>Ne.mergeArray(n,s));let a=[...r.data].map((s,o)=>i.type._parseSync(new ut(r,s,r.path,o)));return Ne.mergeArray(n,a)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};Mt.create=(t,e)=>new Mt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...F(e)});function Rn(t){if(t instanceof We){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=ct.create(Rn(n))}return new We({...t._def,shape:()=>e})}else return t instanceof Mt?new Mt({...t._def,type:Rn(t.element)}):t instanceof ct?ct.create(Rn(t.unwrap())):t instanceof Ct?Ct.create(Rn(t.unwrap())):t instanceof Tt?Tt.create(t.items.map(e=>Rn(e))):t}var We=class t extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Q.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==C.object){let c=this._getOrReturnCtx(e);return E(c,{code:w.invalid_type,expected:C.object,received:c.parsedType}),R}let{status:n,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(let c in i.data)s.includes(c)||o.push(c);let u=[];for(let c of s){let l=a[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ut(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ht){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(E(i,{code:w.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let p=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ut(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let p=await l.key,d=await l.value;c.push({key:p,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,a,s,o;let u=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,r,n).message)!==null&&s!==void 0?s:n.defaultError;return r.code==="unrecognized_keys"?{message:(o=N.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return Q.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Rn(this)}partial(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ct;)a=a._def.innerType;r[n]=a}}),new t({...this._def,shape:()=>r})}keyof(){return Sw(Q.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});var Pr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let s=a.map(o=>new et(o.ctx.common.issues));return E(r,{code:w.invalid_union,unionErrors:s}),R}if(r.common.async)return Promise.all(n.map(async a=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(i);{let a,s=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},l=u._parseSync({data:r.data,path:r.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;let o=s.map(u=>new et(u));return E(r,{code:w.invalid_union,unionErrors:o}),R}}get options(){return this._def.options}};Pr.create=(t,e)=>new Pr({options:t,typeName:I.ZodUnion,...F(e)});var It=t=>t instanceof Nr?It(t.schema):t instanceof tt?It(t.innerType()):t instanceof Or?[t.value]:t instanceof jr?t.options:t instanceof Ir?Q.objectValues(t.enum):t instanceof Rr?It(t._def.innerType):t instanceof Cr?[void 0]:t instanceof Ar?[null]:t instanceof ct?[void 0,...It(t.unwrap())]:t instanceof Ct?[null,...It(t.unwrap())]:t instanceof ha||t instanceof Mr?It(t.unwrap()):t instanceof Dr?It(t._def.innerType):[],So=class t extends B{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return E(r,{code:w.invalid_type,expected:C.object,received:r.parsedType}),R;let n=this.discriminator,i=r.data[n],a=this.optionsMap.get(i);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let a of r){let s=It(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new t({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...F(n)})}};function Id(t,e){let r=Rt(t),n=Rt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let i=Q.objectKeys(e),a=Q.objectKeys(t).filter(o=>i.indexOf(o)!==-1),s={...t,...e};for(let o of a){let u=Id(t[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let a=0;a<t.length;a++){let s=t[a],o=e[a],u=Id(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var qr=class extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(a,s)=>{if(Od(a)||Od(s))return R;let o=Id(a.value,s.value);return o.valid?((jd(a)||jd(s))&&r.dirty(),{status:r.value,value:o.data}):(E(n,{code:w.invalid_intersection_types}),R)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};qr.create=(t,e,r)=>new qr({left:t,right:e,typeName:I.ZodIntersection,...F(r)});var Tt=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return E(n,{code:w.invalid_type,expected:C.array,received:n.parsedType}),R;if(n.data.length<this._def.items.length)return E(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let a=[...n.data].map((s,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ut(n,s,n.path,o)):null}).filter(s=>!!s);return n.common.async?Promise.all(a).then(s=>Ne.mergeArray(r,s)):Ne.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Tt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tt({items:t,typeName:I.ZodTuple,rest:null,...F(e)})};var _o=class t extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return E(n,{code:w.invalid_type,expected:C.object,received:n.parsedType}),R;let i=[],a=this._def.keyType,s=this._def.valueType;for(let o in n.data)i.push({key:a._parse(new ut(n,o,n.path,o)),value:s._parse(new ut(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(r,i):Ne.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof B?new t({keyType:e,valueType:r,typeName:I.ZodRecord,...F(n)}):new t({keyType:Yt.create(),valueType:e,typeName:I.ZodRecord,...F(r)})}},Ln=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return E(n,{code:w.invalid_type,expected:C.map,received:n.parsedType}),R;let i=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map(([o,u],c)=>({key:i._parse(new ut(n,o,n.path,[c,"key"])),value:a._parse(new ut(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of s){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let u of s){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}}}};Ln.create=(t,e,r)=>new Ln({valueType:e,keyType:t,typeName:I.ZodMap,...F(r)});var zn=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return E(n,{code:w.invalid_type,expected:C.set,received:n.parsedType}),R;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(E(n,{code:w.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(E(n,{code:w.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let a=this._def.valueType;function s(u){let c=new Set;for(let l of u){if(l.status==="aborted")return R;l.status==="dirty"&&r.dirty(),c.add(l.value)}return{status:r.value,value:c}}let o=[...n.data.values()].map((u,c)=>a._parse(new ut(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};zn.create=(t,e)=>new zn({valueType:t,minSize:null,maxSize:null,typeName:I.ZodSet,...F(e)});var ko=class t extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return E(r,{code:w.invalid_type,expected:C.function,received:r.parsedType}),R;function n(o,u){return bo({data:o,path:r.path,errorMaps:[r.comm
on.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:u}})}function i(o,u){return bo({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:u}})}let a={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof tr){let o=this;return Le(async function(...u){let c=new et([]),l=await o._def.args.parseAsync(u,a).catch(m=>{throw c.addIssue(n(u,m)),c}),p=await Reflect.apply(s,this,l);return await o._def.returns._def.type.parseAsync(p,a).catch(m=>{throw c.addIssue(i(p,m)),c})})}else{let o=this;return Le(function(...u){let c=o._def.args.safeParse(u,a);if(!c.success)throw new et([n(u,c.error)]);let l=Reflect.apply(s,this,c.data),p=o._def.returns.safeParse(l,a);if(!p.success)throw new et([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Tt.create(e).rest(Dt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Tt.create([]).rest(Dt.create()),returns:r||Dt.create(),typeName:I.ZodFunction,...F(n)})}},Nr=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Nr.create=(t,e)=>new Nr({getter:t,typeName:I.ZodLazy,...F(e)});var Or=class extends B{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return E(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}};Or.create=(t,e)=>new Or({value:t,typeName:I.ZodLiteral,...F(e)});function Sw(t,e){return new jr({values:t,typeName:I.ZodEnum,...F(e)})}var jr=class t extends B{constructor(){super(...arguments),da.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{expected:Q.joinValues(n),received:r.parsedType,code:w.invalid_type}),R}if(wo(this,da,"f")||yw(this,da,new Set(this._def.values),"f"),!wo(this,da,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{received:r.data,code:w.invalid_enum_value,options:n}),R}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};da=new WeakMap;jr.create=Sw;var Ir=class extends B{constructor(){super(...arguments),fa.set(this,void 0)}_parse(e){let r=Q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let i=Q.objectValues(r);return E(n,{expected:Q.joinValues(i),received:n.parsedType,code:w.invalid_type}),R}if(wo(this,fa,"f")||yw(this,fa,new Set(Q.getValidEnumValues(this._def.values)),"f"),!wo(this,fa,"f").has(e.data)){let i=Q.objectValues(r);return E(n,{received:n.data,code:w.invalid_enum_value,options:i}),R}return Le(e.data)}get enum(){return this._def.values}};fa=new WeakMap;Ir.create=(t,e)=>new Ir({values:t,typeName:I.ZodNativeEnum,...F(e)});var tr=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return E(r,{code:w.invalid_type,expected:C.promise,received:r.parsedType}),R;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return Le(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};tr.create=(t,e)=>new tr({type:t,typeName:I.ZodPromise,...F(e)});var tt=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{E(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){let s=i.transform(n.data,a);if(n.common.async)return Promise.resolve(s).then(async o=>{if(r.value==="aborted")return R;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?R:u.status==="dirty"||r.value==="dirty"?Dn(u.value):u});{if(r.value==="aborted")return R;let o=this._def.schema._parseSync({data:s,path:n.path,parent:n});return o.status==="aborted"?R:o.status==="dirty"||r.value==="dirty"?Dn(o.value):o}}if(i.type==="refinement"){let s=o=>{let u=i.refinement(o,a);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Sr(s))return s;let o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Sr(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:r.value,value:o})):s);Q.assertNever(i)}};tt.create=(t,e,r)=>new tt({schema:t,typeName:I.ZodEffects,effect:e,...F(r)});tt.createWithPreprocess=(t,e,r)=>new tt({schema:e,effect:{type:"preprocess",transform:t},typeName:I.ZodEffects,...F(r)});var ct=class extends B{_parse(e){return this._getType(e)===C.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:I.ZodOptional,...F(e)});var Ct=class extends B{_parse(e){return this._getType(e)===C.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ct.create=(t,e)=>new Ct({innerType:t,typeName:I.ZodNullable,...F(e)});var Rr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...F(e)});var Dr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ma(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Dr.create=(t,e)=>new Dr({innerType:t,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...F(e)});var $n=class extends B{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.nan,received:n.parsedType}),R}return{status:"valid",value:e.data}}};$n.create=t=>new $n({typeName:I.ZodNaN,...F(t)});var hP=Symbol("zod_brand"),ha=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},va=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?R:a.status==="dirty"?(r.dirty(),Dn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?R:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:I.ZodPipeline})}},Mr=class extends B{_parse(e){let r=this._def.innerType._parse(e),n=i=>(Sr(i)&&(i.value=Object.freeze(i.value)),i);return ma(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:I.ZodReadonly,...F(e)});function hw(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function _w(t,e={},r){return t?er.create().superRefine((n,i)=>{var a,s;let o=t(n);if(o instanceof Promise)return o.then(u=>{var c,l;if(!u){let p=hw(e,n),d=(l=(c=p.fatal)!==null&&c!==void 0?c:r)!==null&&l!==void 0?l:!0;i.addIssue({code:"custom",...p,fatal:d})}});if(!o){let u=hw(e,n),c=(s=(a=u.fatal)!==null&&a!==void 0?a:r)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...u,fatal:c})}}):er.create()}var vP={object:We.lazycreate},I;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(I||(I={}));var gP=(t,e={message:`Input not instance of ${t.name}`})=>_w(r=>r instanceof t,e),kw=Yt.create,Ew=_r.create,yP=$n.create,xP=kr.create,Tw=Er.create,bP=Tr.create,wP=Fn.create,SP=Cr.create,_P=Ar.create,kP=er.create,EP=Dt.create,TP=ht.create,CP=Bn.create,AP=Mt.create,PP=We.create,qP=We.strictCreate,NP=Pr.create,OP=So.create,jP=qr.create,IP=Tt.create,RP=_o.create,DP=Ln.create,MP=zn.create,FP=ko.create,BP=Nr.create,LP=Or.create,zP=jr.create,$P=Ir.create,UP=tr.create,vw=tt.create,QP=ct.create,VP=Ct.create,HP=tt.createWithPreprocess,GP=va.create,KP=()=>kw().optional(),ZP=()=>Ew().optional(),WP=()=>Tw().optional(),XP={string:(t=>Yt.create({...t,coerce:!0})),number:(t=>_r.create({...t,coerce:!0})),boolean:(t=>Er.create({...t,coerce:!0})),bigint:(t=>kr.create({...t,coerce:!0})),date:(t=>Tr.create({...t,coerce:!0}))},JP=R,ye=Object.freeze({__proto__:null,defaultErrorMap:Mn,setErrorMap:H9,getErrorMap:xo,makeIssue:bo,EMPTY_PATH:G9,addIssueToContext:E,ParseStatus:Ne,INVALID:R,DIRTY:Dn,OK:Le,isAborted:Od,isDirty:jd,isValid:Sr,isAsync:ma,get util(){return Q},get objectUtil(){return Nd},ZodParsedType:C,getParsedType:Rt,ZodType:B,datetimeRegex:ww,ZodString:Yt,ZodNumber:_r,ZodBigInt:kr,ZodBoolean:Er,ZodDate:Tr,ZodSymbol:Fn,ZodUndefined:Cr,ZodNull:Ar,ZodAny:er,ZodUnknown:Dt,ZodNever:ht,ZodVoid:Bn,ZodArray:Mt,ZodObject:We,ZodUnion:Pr,ZodDiscriminatedUnion:So,ZodIntersection:qr,ZodTuple:Tt,ZodRecord:_o,ZodMap:Ln,ZodSet:zn,ZodFunction:ko,ZodLazy:Nr,ZodLiteral:Or,ZodEnum:jr,ZodNativeEnum:Ir,ZodPromise:tr,ZodEffects:tt,ZodTransformer:tt,ZodOptional:ct,ZodNullable:Ct,ZodDefault:Rr,ZodCatch:Dr,ZodNaN:$n,BRAND:hP,ZodBranded:ha,ZodPipeline:va,ZodReadonly:Mr,custom:_w,Schema:B,ZodSchema:B,late:vP,get ZodFirstPartyTypeKind(){return I},coerce:XP,any:kP,array:AP,bigint:xP,boolean:Tw,date:bP,discriminatedUnion:OP,effect:vw,enum:zP,function:FP,instanceof:gP,intersection:jP,lazy:BP,literal:LP,map:DP,nan:yP,nativeEnum:$P,never:TP,null:_P,nullable:VP,number:Ew,object:PP,oboolean:WP,onumber:ZP,optional:QP,ostring:KP,pipeline:GP,preprocess:HP,promise:UP,record:RP,set:MP,strictObject:qP,string:kw,symbol:wP,transformer:vw,tuple:IP,undefined:SP,union:NP,unknown:EP,void:CP,NEVER:JP,ZodIssueCode:w,quotelessJson:V9,ZodError:et});var ce={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function fe(t,e){return e.includes(t.columnType)}function YP(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var eq=ye.union([ye.string(),ye.number(),ye.boolean(),ye.null()]),tq=ye.union([eq,ye.record(ye.any()),ye.array(ye.any())]),rq=ye.custom(t=>t instanceof Buffer);function Cw(t,e){let r=e?.zodInstance??ye,n=e?.coerce??{},i;return YP(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(fe(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):fe(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):fe(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):fe(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):fe(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):fe(t,["PgArray"])?(i=r.array(Cw(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=nq(t,r,n):t.dataType==="bigint"?i=iq(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=aq(t,r,n):t.dataType==="json"?i=tq:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=rq)),i||(i=r.any()),i}function nq(t,e,r){let n=t.getSQLType().includes("unsigned"),i,a,s=!1;fe(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:ce.INT8_MIN,a=n?ce.INT8_UNSIGNED_MAX:ce.INT8_MAX,s=!0):fe(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:ce.INT16_MIN,a=n?ce.INT16_UNSIGNED_MAX:ce.INT16_MAX,s=!0):fe(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:ce.INT24_MIN,a=n?ce.INT24_UNSIGNED_MAX:ce.INT24_MAX,s=fe(t,["MySqlMediumInt","SingleStoreMediumInt"])):fe(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:ce.INT32_MIN,a=n?ce.INT32_UNSIGNED_MAX:ce.INT32_MAX,s=!0):fe(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:ce.INT48_MIN,a=n?ce.INT48_UNSIGNED_MAX:ce.INT48_MAX):fe(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||fe(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=!0):fe(t,["MySqlYear","SingleStoreYear"])?(i=1901,a=2155,s=!0):(i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(a),s?o.int():o}function iq(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:ce.INT64_MIN,a=n?ce.INT64_UNSIGNED_MAX:ce.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(a)}function aq(t,e,r){if(fe(t,["PgUUID"]))return e.string().uuid();let n,i,a=!1;fe(t,["PgVarchar","SQLiteText"])?n=t.length:fe(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??ce.INT16_UNSIGNED_MAX:fe(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=ce.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=ce.INT24_UNSIGNED_MAX:t.textType==="text"?n=ce.INT16_UNSIGNED_MAX:n=ce.INT8_UNSIGNED_MAX),fe(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,a=!0),fe(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let s=r===!0||r?.string?e.coerce.string():e.string();return s=i?s.regex(i):s,n&&a?s.length(n):n?s.max(n):s}function Aw(t){return tp(t)?Xs(t):a1(t)}function Pw(t,e,r,n){let i={};for(let[a,s]of Object.entries(t)){if(!x(s,H)&&!x(s,A)&&!x(s,A.Aliased)&&typeof s=="object"){let p=tp(s)||t1(s)?Aw(s):s;i[a]=Pw(p,e[a]??{},r,n);continue}let o=e[a];if(o!==void 0&&typeof o!="function"){i[a]=o;continue}let u=x(s,H)?s:void 0,c=u?Cw(u,n):ye.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[a]=l,u&&(r.nullable(u)&&(i[a]=i[a].nullable()),r.optional(u)&&(i[a]=i[a].optional())))}return ye.object(i)}var sq={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var qw=(t,e)=>{let r=Aw(t);return Pw(r,e??{},sq)};var ga=L1("services",{id:eo("id").primaryKey(),title:wr("title").notNull(),description:wr("description").notNull(),category:wr("category").notNull(),icon:wr("icon").notNull()}),oq=qw(ga).omit({id:!0});var{Pool:cq}=Wt;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var uq=new cq({connectionString:process.env.DATABASE_URL}),Dd=yo(uq,{schema:Rd});var Md=class{async getServices(){return await Dd.select().from(ga)}async createService(e){let[r]=await Dd.insert(ga).values(e).returning();return r}},Eo=new Md;var MB={internal:ye.object({message:ye.string()})},Nw={services:{list:{method:"GET",path:"/api/services",responses:{200:ye.array(ye.custom())}}}};async function lq(){if((await Eo.getServices()).length===0){let e=[{title:"Guarda",description:"Prote\xE7\xE3o e bem-estar dos filhos e menores.",category:"Fam\xEDlia",icon:"Shield"},{title:"Investiga\xE7\xE3o de Paternidade",description:"Reconhecimento biol\xF3gico e garantia de direitos.",category:"Fam\xEDlia",icon:"Search"},{title:"Div\xF3rcio",description:"Atua\xE7\xE3o em div\xF3rcios judiciais e extrajudiciais.",category:"Fam\xEDlia",icon:"HeartCrack"},{title:"Regulariza\xE7\xE3o de Im\xF3vel",description:"Regulariza\xE7\xE3o documental e usucapi\xE3o.",category:"Civil",icon:"Home"},{title:"Indeniza\xE7\xE3o",description:"A\xE7\xF5es de repara\xE7\xE3o por danos materiais e morais.",category:"Civil",icon:"Gavel"},{title:"Direito do Consumidor",description:"Defesa contra pr\xE1ticas abusivas e defeitos.",category:"Civil",icon:"ShoppingBag"},{title:"Consultoria C\xEDvel",description:"Orienta\xE7\xE3o preventiva e an\xE1lise de riscos.",category:"Civil",icon:"BookOpen"},{title:"Acordos Extrajudiciais",description:"Resolu\xE7\xE3o de conflitos de forma amig\xE1vel.",category:"Civil",icon:"Handshake"},{title:"Planejamento Patrimonial",description:"Organiza\xE7\xE3o e prote\xE7\xE3o de bens e heran\xE7a.",category:"Civil",icon:"Briefcase"}];for(let r of e)await Eo.createService(r);console.log("Database seeded with services.")}}async function Ow(t,e){return await lq(),e.get(Nw.services.list.path,async(r,n)=>{let i=await Eo.getServices();n.json(i)}),t}var jw=Qn(Mu(),1),Iw=Qn(require("fs"),1),Fd=Qn(require("path"),1);function Rw(t){let e=Fd.default.resolve(__dirname,"public");if(!Iw.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);t.use(jw.default.static(e)),t.use("*",(r,n)=>{n.sendFile(Fd.default.resolve(e,"index.html"))})}var Mw=require("http"),Fr=(0,To.default)(),Dw=(0,Mw.createServer)(Fr);Fr.use(To.default.json({verify:(t,e,r)=>{t.rawBody=r}}));Fr.use(To.default.urlencoded({extended:!1}));function Bd(t,e="express"){let r=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${r} [${e}] ${t}`)}Fr.use((t,e,r)=>{let n=Date.now(),i=t.path,a,s=e.json;e.json=function(o,...u){return a=o,s.apply(e,[o,...u])},e.on("finish",()=>{let o=Date.now()-n;if(i.startsWith("/api")){let u=`${t.method} ${i} ${e.statusCode} in ${o}ms`;a&&(u+=` :: ${JSON.stringify(a)}`),Bd(u)}}),r()});(async()=>{await Ow(Dw,Fr),Fr.use((e,r,n,i)=>{let a=e.status||e.statusCode||500,s=e.message||"Internal Server Error";throw n.status(a).json({message:s}),e}),Rw(Fr);let t=parseInt(process.env.PORT||"5000",10);Dw.listen({port:t,host:"0.0.0.0",reusePort:!0},()=>{Bd(`serving on port ${t}`)})})();0&&(module.exports={log});
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/app/dist/index.cjs:70:99269)
    at Module._compile (node:internal/modules/cjs/loader:1706:14)
    at Object..js (node:internal/modules/cjs/loader:1839:10)
    at Module.load (node:internal/modules/cjs/loader:1441:32)
    at Function._load (node:internal/modules/cjs/loader:1263:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.21.1
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};kr.create=t=>{var e;return new kr({checks:[],typeName:I.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};var Er=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.boolean,received:n.parsedType}),R}return Le(e.data)}};Er.create=t=>new Er({typeName:I.ZodBoolean,coerce:t?.coerce||!1,...F(t)});var Tr=class t extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.date,received:a.parsedType}),R}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_date}),R}let n=new Ne,i;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Q.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Tr.create=t=>new Tr({checks:[],coerce:t?.coerce||!1,typeName:I.ZodDate,...F(t)});var Fn=class extends B{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.symbol,received:n.parsedType}),R}return Le(e.data)}};Fn.create=t=>new Fn({typeName:I.ZodSymbol,...F(t)});var Cr=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.undefined,received:n.parsedType}),R}return Le(e.data)}};Cr.create=t=>new Cr({typeName:I.ZodUndefined,...F(t)});var Ar=class extends B{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.null,received:n.parsedType}),R}return Le(e.data)}};Ar.create=t=>new Ar({typeName:I.ZodNull,...F(t)});var er=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};er.create=t=>new er({typeName:I.ZodAny,...F(t)});var Dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};Dt.create=t=>new Dt({typeName:I.ZodUnknown,...F(t)});var ht=class extends B{_parse(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.never,received:r.parsedType}),R}};ht.create=t=>new ht({typeName:I.ZodNever,...F(t)});var Bn=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.void,received:n.parsedType}),R}return Le(e.data)}};Bn.create=t=>new Bn({typeName:I.ZodVoid,...F(t)});var Mt=class t extends B{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==C.array)return E(r,{code:w.invalid_type,expected:C.array,received:r.parsedType}),R;if(i.exactLength!==null){let s=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(s||o)&&(E(r,{code:s?w.too_big:w.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(E(r,{code:w.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(E(r,{code:w.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,o)=>i.type._parseAsync(new ut(r,s,r.path,o)))).then(s=>Ne.mergeArray(n,s));let a=[...r.data].map((s,o)=>i.type._parseSync(new ut(r,s,r.path,o)));return Ne.mergeArray(n,a)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};Mt.create=(t,e)=>new Mt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...F(e)});function Rn(t){if(t instanceof We){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=ct.create(Rn(n))}return new We({...t._def,shape:()=>e})}else return t instanceof Mt?new Mt({...t._def,type:Rn(t.element)}):t instanceof ct?ct.create(Rn(t.unwrap())):t instanceof Ct?Ct.create(Rn(t.unwrap())):t instanceof Tt?Tt.create(t.items.map(e=>Rn(e))):t}var We=class t extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Q.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==C.object){let c=this._getOrReturnCtx(e);return E(c,{code:w.invalid_type,expected:C.object,received:c.parsedType}),R}let{status:n,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(let c in i.data)s.includes(c)||o.push(c);let u=[];for(let c of s){let l=a[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ut(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ht){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(E(i,{code:w.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let p=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ut(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let p=await l.key,d=await l.value;c.push({key:p,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,a,s,o;let u=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,r,n).message)!==null&&s!==void 0?s:n.defaultError;return r.code==="unrecognized_keys"?{message:(o=N.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return Q.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Rn(this)}partial(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ct;)a=a._def.innerType;r[n]=a}}),new t({...this._def,shape:()=>r})}keyof(){return Sw(Q.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});var Pr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let s=a.map(o=>new et(o.ctx.common.issues));return E(r,{code:w.invalid_union,unionErrors:s}),R}if(r.common.async)return Promise.all(n.map(async a=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(i);{let a,s=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},l=u._parseSync({data:r.data,path:r.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;let o=s.map(u=>new et(u));return E(r,{code:w.invalid_union,unionErrors:o}),R}}get options(){return this._def.options}};Pr.create=(t,e)=>new Pr({options:t,typeName:I.ZodUnion,...F(e)});var It=t=>t instanceof Nr?It(t.schema):t instanceof tt?It(t.innerType()):t instanceof Or?[t.value]:t instanceof jr?t.options:t instanceof Ir?Q.objectValues(t.enum):t instanceof Rr?It(t._def.innerType):t instanceof Cr?[void 0]:t instanceof Ar?[null]:t instanceof ct?[void 0,...It(t.unwrap())]:t instanceof Ct?[null,...It(t.unwrap())]:t instanceof ha||t instanceof Mr?It(t.unwrap()):t instanceof Dr?It(t._def.innerType):[],So=class t extends B{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return E(r,{code:w.invalid_type,expected:C.object,received:r.parsedType}),R;let n=this.discriminator,i=r.data[n],a=this.optionsMap.get(i);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let a of r){let s=It(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new t({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...F(n)})}};function Id(t,e){let r=Rt(t),n=Rt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let i=Q.objectKeys(e),a=Q.objectKeys(t).filter(o=>i.indexOf(o)!==-1),s={...t,...e};for(let o of a){let u=Id(t[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let a=0;a<t.length;a++){let s=t[a],o=e[a],u=Id(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var qr=class extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(a,s)=>{if(Od(a)||Od(s))return R;let o=Id(a.value,s.value);return o.valid?((jd(a)||jd(s))&&r.dirty(),{status:r.value,value:o.data}):(E(n,{code:w.invalid_intersection_types}),R)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};qr.create=(t,e,r)=>new qr({left:t,right:e,typeName:I.ZodIntersection,...F(r)});var Tt=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return E(n,{code:w.invalid_type,expected:C.array,received:n.parsedType}),R;if(n.data.length<this._def.items.length)return E(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let a=[...n.data].map((s,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ut(n,s,n.path,o)):null}).filter(s=>!!s);return n.common.async?Promise.all(a).then(s=>Ne.mergeArray(r,s)):Ne.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Tt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tt({items:t,typeName:I.ZodTuple,rest:null,...F(e)})};var _o=class t extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return E(n,{code:w.invalid_type,expected:C.object,received:n.parsedType}),R;let i=[],a=this._def.keyType,s=this._def.valueType;for(let o in n.data)i.push({key:a._parse(new ut(n,o,n.path,o)),value:s._parse(new ut(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(r,i):Ne.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof B?new t({keyType:e,valueType:r,typeName:I.ZodRecord,...F(n)}):new t({keyType:Yt.create(),valueType:e,typeName:I.ZodRecord,...F(r)})}},Ln=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return E(n,{code:w.invalid_type,expected:C.map,received:n.parsedType}),R;let i=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map(([o,u],c)=>({key:i._parse(new ut(n,o,n.path,[c,"key"])),value:a._parse(new ut(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of s){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let u of s){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}}}};Ln.create=(t,e,r)=>new Ln({valueType:e,keyType:t,typeName:I.ZodMap,...F(r)});var zn=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return E(n,{code:w.invalid_type,expected:C.set,received:n.parsedType}),R;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(E(n,{code:w.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(E(n,{code:w.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let a=this._def.valueType;function s(u){let c=new Set;for(let l of u){if(l.status==="aborted")return R;l.status==="dirty"&&r.dirty(),c.add(l.value)}return{status:r.value,value:c}}let o=[...n.data.values()].map((u,c)=>a._parse(new ut(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};zn.create=(t,e)=>new zn({valueType:t,minSize:null,maxSize:null,typeName:I.ZodSet,...F(e)});var ko=class t extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return E(r,{code:w.invalid_type,expected:C.function,received:r.parsedType}),R;function n(o,u){return bo({data:o,path:r.path,errorMaps:[r.comm
on.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:u}})}function i(o,u){return bo({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:u}})}let a={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof tr){let o=this;return Le(async function(...u){let c=new et([]),l=await o._def.args.parseAsync(u,a).catch(m=>{throw c.addIssue(n(u,m)),c}),p=await Reflect.apply(s,this,l);return await o._def.returns._def.type.parseAsync(p,a).catch(m=>{throw c.addIssue(i(p,m)),c})})}else{let o=this;return Le(function(...u){let c=o._def.args.safeParse(u,a);if(!c.success)throw new et([n(u,c.error)]);let l=Reflect.apply(s,this,c.data),p=o._def.returns.safeParse(l,a);if(!p.success)throw new et([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Tt.create(e).rest(Dt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Tt.create([]).rest(Dt.create()),returns:r||Dt.create(),typeName:I.ZodFunction,...F(n)})}},Nr=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Nr.create=(t,e)=>new Nr({getter:t,typeName:I.ZodLazy,...F(e)});var Or=class extends B{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return E(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}};Or.create=(t,e)=>new Or({value:t,typeName:I.ZodLiteral,...F(e)});function Sw(t,e){return new jr({values:t,typeName:I.ZodEnum,...F(e)})}var jr=class t extends B{constructor(){super(...arguments),da.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{expected:Q.joinValues(n),received:r.parsedType,code:w.invalid_type}),R}if(wo(this,da,"f")||yw(this,da,new Set(this._def.values),"f"),!wo(this,da,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{received:r.data,code:w.invalid_enum_value,options:n}),R}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};da=new WeakMap;jr.create=Sw;var Ir=class extends B{constructor(){super(...arguments),fa.set(this,void 0)}_parse(e){let r=Q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let i=Q.objectValues(r);return E(n,{expected:Q.joinValues(i),received:n.parsedType,code:w.invalid_type}),R}if(wo(this,fa,"f")||yw(this,fa,new Set(Q.getValidEnumValues(this._def.values)),"f"),!wo(this,fa,"f").has(e.data)){let i=Q.objectValues(r);return E(n,{received:n.data,code:w.invalid_enum_value,options:i}),R}return Le(e.data)}get enum(){return this._def.values}};fa=new WeakMap;Ir.create=(t,e)=>new Ir({values:t,typeName:I.ZodNativeEnum,...F(e)});var tr=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return E(r,{code:w.invalid_type,expected:C.promise,received:r.parsedType}),R;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return Le(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};tr.create=(t,e)=>new tr({type:t,typeName:I.ZodPromise,...F(e)});var tt=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{E(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){let s=i.transform(n.data,a);if(n.common.async)return Promise.resolve(s).then(async o=>{if(r.value==="aborted")return R;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?R:u.status==="dirty"||r.value==="dirty"?Dn(u.value):u});{if(r.value==="aborted")return R;let o=this._def.schema._parseSync({data:s,path:n.path,parent:n});return o.status==="aborted"?R:o.status==="dirty"||r.value==="dirty"?Dn(o.value):o}}if(i.type==="refinement"){let s=o=>{let u=i.refinement(o,a);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Sr(s))return s;let o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Sr(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:r.value,value:o})):s);Q.assertNever(i)}};tt.create=(t,e,r)=>new tt({schema:t,typeName:I.ZodEffects,effect:e,...F(r)});tt.createWithPreprocess=(t,e,r)=>new tt({schema:e,effect:{type:"preprocess",transform:t},typeName:I.ZodEffects,...F(r)});var ct=class extends B{_parse(e){return this._getType(e)===C.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:I.ZodOptional,...F(e)});var Ct=class extends B{_parse(e){return this._getType(e)===C.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ct.create=(t,e)=>new Ct({innerType:t,typeName:I.ZodNullable,...F(e)});var Rr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...F(e)});var Dr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ma(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Dr.create=(t,e)=>new Dr({innerType:t,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...F(e)});var $n=class extends B{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.nan,received:n.parsedType}),R}return{status:"valid",value:e.data}}};$n.create=t=>new $n({typeName:I.ZodNaN,...F(t)});var hP=Symbol("zod_brand"),ha=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},va=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?R:a.status==="dirty"?(r.dirty(),Dn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?R:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:I.ZodPipeline})}},Mr=class extends B{_parse(e){let r=this._def.innerType._parse(e),n=i=>(Sr(i)&&(i.value=Object.freeze(i.value)),i);return ma(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:I.ZodReadonly,...F(e)});function hw(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function _w(t,e={},r){return t?er.create().superRefine((n,i)=>{var a,s;let o=t(n);if(o instanceof Promise)return o.then(u=>{var c,l;if(!u){let p=hw(e,n),d=(l=(c=p.fatal)!==null&&c!==void 0?c:r)!==null&&l!==void 0?l:!0;i.addIssue({code:"custom",...p,fatal:d})}});if(!o){let u=hw(e,n),c=(s=(a=u.fatal)!==null&&a!==void 0?a:r)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...u,fatal:c})}}):er.create()}var vP={object:We.lazycreate},I;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(I||(I={}));var gP=(t,e={message:`Input not instance of ${t.name}`})=>_w(r=>r instanceof t,e),kw=Yt.create,Ew=_r.create,yP=$n.create,xP=kr.create,Tw=Er.create,bP=Tr.create,wP=Fn.create,SP=Cr.create,_P=Ar.create,kP=er.create,EP=Dt.create,TP=ht.create,CP=Bn.create,AP=Mt.create,PP=We.create,qP=We.strictCreate,NP=Pr.create,OP=So.create,jP=qr.create,IP=Tt.create,RP=_o.create,DP=Ln.create,MP=zn.create,FP=ko.create,BP=Nr.create,LP=Or.create,zP=jr.create,$P=Ir.create,UP=tr.create,vw=tt.create,QP=ct.create,VP=Ct.create,HP=tt.createWithPreprocess,GP=va.create,KP=()=>kw().optional(),ZP=()=>Ew().optional(),WP=()=>Tw().optional(),XP={string:(t=>Yt.create({...t,coerce:!0})),number:(t=>_r.create({...t,coerce:!0})),boolean:(t=>Er.create({...t,coerce:!0})),bigint:(t=>kr.create({...t,coerce:!0})),date:(t=>Tr.create({...t,coerce:!0}))},JP=R,ye=Object.freeze({__proto__:null,defaultErrorMap:Mn,setErrorMap:H9,getErrorMap:xo,makeIssue:bo,EMPTY_PATH:G9,addIssueToContext:E,ParseStatus:Ne,INVALID:R,DIRTY:Dn,OK:Le,isAborted:Od,isDirty:jd,isValid:Sr,isAsync:ma,get util(){return Q},get objectUtil(){return Nd},ZodParsedType:C,getParsedType:Rt,ZodType:B,datetimeRegex:ww,ZodString:Yt,ZodNumber:_r,ZodBigInt:kr,ZodBoolean:Er,ZodDate:Tr,ZodSymbol:Fn,ZodUndefined:Cr,ZodNull:Ar,ZodAny:er,ZodUnknown:Dt,ZodNever:ht,ZodVoid:Bn,ZodArray:Mt,ZodObject:We,ZodUnion:Pr,ZodDiscriminatedUnion:So,ZodIntersection:qr,ZodTuple:Tt,ZodRecord:_o,ZodMap:Ln,ZodSet:zn,ZodFunction:ko,ZodLazy:Nr,ZodLiteral:Or,ZodEnum:jr,ZodNativeEnum:Ir,ZodPromise:tr,ZodEffects:tt,ZodTransformer:tt,ZodOptional:ct,ZodNullable:Ct,ZodDefault:Rr,ZodCatch:Dr,ZodNaN:$n,BRAND:hP,ZodBranded:ha,ZodPipeline:va,ZodReadonly:Mr,custom:_w,Schema:B,ZodSchema:B,late:vP,get ZodFirstPartyTypeKind(){return I},coerce:XP,any:kP,array:AP,bigint:xP,boolean:Tw,date:bP,discriminatedUnion:OP,effect:vw,enum:zP,function:FP,instanceof:gP,intersection:jP,lazy:BP,literal:LP,map:DP,nan:yP,nativeEnum:$P,never:TP,null:_P,nullable:VP,number:Ew,object:PP,oboolean:WP,onumber:ZP,optional:QP,ostring:KP,pipeline:GP,preprocess:HP,promise:UP,record:RP,set:MP,strictObject:qP,string:kw,symbol:wP,transformer:vw,tuple:IP,undefined:SP,union:NP,unknown:EP,void:CP,NEVER:JP,ZodIssueCode:w,quotelessJson:V9,ZodError:et});var ce={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function fe(t,e){return e.includes(t.columnType)}function YP(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var eq=ye.union([ye.string(),ye.number(),ye.boolean(),ye.null()]),tq=ye.union([eq,ye.record(ye.any()),ye.array(ye.any())]),rq=ye.custom(t=>t instanceof Buffer);function Cw(t,e){let r=e?.zodInstance??ye,n=e?.coerce??{},i;return YP(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(fe(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):fe(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):fe(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):fe(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):fe(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):fe(t,["PgArray"])?(i=r.array(Cw(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=nq(t,r,n):t.dataType==="bigint"?i=iq(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=aq(t,r,n):t.dataType==="json"?i=tq:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=rq)),i||(i=r.any()),i}function nq(t,e,r){let n=t.getSQLType().includes("unsigned"),i,a,s=!1;fe(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:ce.INT8_MIN,a=n?ce.INT8_UNSIGNED_MAX:ce.INT8_MAX,s=!0):fe(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:ce.INT16_MIN,a=n?ce.INT16_UNSIGNED_MAX:ce.INT16_MAX,s=!0):fe(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:ce.INT24_MIN,a=n?ce.INT24_UNSIGNED_MAX:ce.INT24_MAX,s=fe(t,["MySqlMediumInt","SingleStoreMediumInt"])):fe(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:ce.INT32_MIN,a=n?ce.INT32_UNSIGNED_MAX:ce.INT32_MAX,s=!0):fe(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:ce.INT48_MIN,a=n?ce.INT48_UNSIGNED_MAX:ce.INT48_MAX):fe(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||fe(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=!0):fe(t,["MySqlYear","SingleStoreYear"])?(i=1901,a=2155,s=!0):(i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(a),s?o.int():o}function iq(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:ce.INT64_MIN,a=n?ce.INT64_UNSIGNED_MAX:ce.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(a)}function aq(t,e,r){if(fe(t,["PgUUID"]))return e.string().uuid();let n,i,a=!1;fe(t,["PgVarchar","SQLiteText"])?n=t.length:fe(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??ce.INT16_UNSIGNED_MAX:fe(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=ce.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=ce.INT24_UNSIGNED_MAX:t.textType==="text"?n=ce.INT16_UNSIGNED_MAX:n=ce.INT8_UNSIGNED_MAX),fe(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,a=!0),fe(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let s=r===!0||r?.string?e.coerce.string():e.string();return s=i?s.regex(i):s,n&&a?s.length(n):n?s.max(n):s}function Aw(t){return tp(t)?Xs(t):a1(t)}function Pw(t,e,r,n){let i={};for(let[a,s]of Object.entries(t)){if(!x(s,H)&&!x(s,A)&&!x(s,A.Aliased)&&typeof s=="object"){let p=tp(s)||t1(s)?Aw(s):s;i[a]=Pw(p,e[a]??{},r,n);continue}let o=e[a];if(o!==void 0&&typeof o!="function"){i[a]=o;continue}let u=x(s,H)?s:void 0,c=u?Cw(u,n):ye.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[a]=l,u&&(r.nullable(u)&&(i[a]=i[a].nullable()),r.optional(u)&&(i[a]=i[a].optional())))}return ye.object(i)}var sq={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var qw=(t,e)=>{let r=Aw(t);return Pw(r,e??{},sq)};var ga=L1("services",{id:eo("id").primaryKey(),title:wr("title").notNull(),description:wr("description").notNull(),category:wr("category").notNull(),icon:wr("icon").notNull()}),oq=qw(ga).omit({id:!0});var{Pool:cq}=Wt;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var uq=new cq({connectionString:process.env.DATABASE_URL}),Dd=yo(uq,{schema:Rd});var Md=class{async getServices(){return await Dd.select().from(ga)}async createService(e){let[r]=await Dd.insert(ga).values(e).returning();return r}},Eo=new Md;var MB={internal:ye.object({message:ye.string()})},Nw={services:{list:{method:"GET",path:"/api/services",responses:{200:ye.array(ye.custom())}}}};async function lq(){if((await Eo.getServices()).length===0){let e=[{title:"Guarda",description:"Prote\xE7\xE3o e bem-estar dos filhos e menores.",category:"Fam\xEDlia",icon:"Shield"},{title:"Investiga\xE7\xE3o de Paternidade",description:"Reconhecimento biol\xF3gico e garantia de direitos.",category:"Fam\xEDlia",icon:"Search"},{title:"Div\xF3rcio",description:"Atua\xE7\xE3o em div\xF3rcios judiciais e extrajudiciais.",category:"Fam\xEDlia",icon:"HeartCrack"},{title:"Regulariza\xE7\xE3o de Im\xF3vel",description:"Regulariza\xE7\xE3o documental e usucapi\xE3o.",category:"Civil",icon:"Home"},{title:"Indeniza\xE7\xE3o",description:"A\xE7\xF5es de repara\xE7\xE3o por danos materiais e morais.",category:"Civil",icon:"Gavel"},{title:"Direito do Consumidor",description:"Defesa contra pr\xE1ticas abusivas e defeitos.",category:"Civil",icon:"ShoppingBag"},{title:"Consultoria C\xEDvel",description:"Orienta\xE7\xE3o preventiva e an\xE1lise de riscos.",category:"Civil",icon:"BookOpen"},{title:"Acordos Extrajudiciais",description:"Resolu\xE7\xE3o de conflitos de forma amig\xE1vel.",category:"Civil",icon:"Handshake"},{title:"Planejamento Patrimonial",description:"Organiza\xE7\xE3o e prote\xE7\xE3o de bens e heran\xE7a.",category:"Civil",icon:"Briefcase"}];for(let r of e)await Eo.createService(r);console.log("Database seeded with services.")}}async function Ow(t,e){return await lq(),e.get(Nw.services.list.path,async(r,n)=>{let i=await Eo.getServices();n.json(i)}),t}var jw=Qn(Mu(),1),Iw=Qn(require("fs"),1),Fd=Qn(require("path"),1);function Rw(t){let e=Fd.default.resolve(__dirname,"public");if(!Iw.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);t.use(jw.default.static(e)),t.use("*",(r,n)=>{n.sendFile(Fd.default.resolve(e,"index.html"))})}var Mw=require("http"),Fr=(0,To.default)(),Dw=(0,Mw.createServer)(Fr);Fr.use(To.default.json({verify:(t,e,r)=>{t.rawBody=r}}));Fr.use(To.default.urlencoded({extended:!1}));function Bd(t,e="express"){let r=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${r} [${e}] ${t}`)}Fr.use((t,e,r)=>{let n=Date.now(),i=t.path,a,s=e.json;e.json=function(o,...u){return a=o,s.apply(e,[o,...u])},e.on("finish",()=>{let o=Date.now()-n;if(i.startsWith("/api")){let u=`${t.method} ${i} ${e.statusCode} in ${o}ms`;a&&(u+=` :: ${JSON.stringify(a)}`),Bd(u)}}),r()});(async()=>{await Ow(Dw,Fr),Fr.use((e,r,n,i)=>{let a=e.status||e.statusCode||500,s=e.message||"Internal Server Error";throw n.status(a).json({message:s}),e}),Rw(Fr);let t=parseInt(process.env.PORT||"5000",10);Dw.listen({port:t,host:"0.0.0.0",reusePort:!0},()=>{Bd(`serving on port ${t}`)})})();0&&(module.exports={log});
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/app/dist/index.cjs:70:99269)
    at Module._compile (node:internal/modules/cjs/loader:1706:14)
    at Object..js (node:internal/modules/cjs/loader:1839:10)
    at Module.load (node:internal/modules/cjs/loader:1441:32)
    at Function._load (node:internal/modules/cjs/loader:1263:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
Node.js v22.21.1
    at node:internal/main/run_main_module:36:49
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70
		`;await r.execute(h`CREATE SCHEMA IF NOT EXISTS ${h.identifier(a)}`),await r.execute(s);let u=(await r.all(h`select id, hash, created_at from ${h.identifier(a)}.${h.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async c=>{for await(let l of e)if(!u||Number(u.created_at)<l.folderMillis){for(let p of l.sql)await c.execute(h.raw(p));await c.execute(h`insert into ${h.identifier(a)}.${h.identifier(i)} ("hash", "created_at") values(${l.hash}, ${l.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[h`with `];for(let[n,i]of e.entries())r.push(h`${h.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(h`, `);return r.push(h` `),h.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let a=this.buildWithCTE(i),s=n?h` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?h` where ${r}`:void 0;return h`${a}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[T.Symbol.Columns],i=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),a=i.length;return h.join(i.flatMap((s,o)=>{let u=n[s],c=r[s]??h.param(u.onUpdateFn(),u),l=h`${h.identifier(this.casing.getColumnCasing(u))} = ${c}`;return o<a-1?[l,h.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:a,from:s,joins:o}){let u=this.buildWithCTE(a),c=e[Ce.Symbol.Name],l=e[Ce.Symbol.Schema],p=e[Ce.Symbol.OriginalName],d=c===p?void 0:c,m=h`${l?h`${h.identifier(l)}.`:void 0}${h.identifier(p)}${d&&h` ${h.identifier(d)}`}`,g=this.buildUpdateSet(e,r),y=s&&h.join([h.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),k=i?h` returning ${this.buildSelection(i,{isSingleTable:!s})}`:void 0,q=n?h` where ${n}`:void 0;return h`${u}update ${m} set ${g}${y}${b}${q}${k}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:a},s)=>{let o=[];if(x(a,A.Aliased)&&a.isSelectionField)o.push(h.identifier(a.fieldAlias));else if(x(a,A.Aliased)||x(a,A)){let u=x(a,A.Aliased)?a.sql:a;r?o.push(new A(u.queryChunks.map(c=>x(c,S)?h.identifier(this.casing.getColumnCasing(c)):c))):o.push(u),x(a,A.Aliased)&&o.push(h` as ${h.identifier(a.fieldAlias)}`)}else x(a,H)&&(r?o.push(h.identifier(this.casing.getColumnCasing(a))):o.push(a));return s<n-1&&o.push(h`, `),o});return h.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(h` `);let a=i.table,s=i.lateral?h` lateral`:void 0;if(x(a,Ce)){let o=a[Ce.Symbol.Name],u=a[Ce.Symbol.Schema],c=a[Ce.Symbol.OriginalName],l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else if(x(a,Be)){let o=a[te].name,u=a[te].schema,c=a[te].originalName,l=o===c?void 0:i.alias;r.push(h`${h.raw(i.joinType)} join${s} ${u?h`${h.identifier(u)}.`:void 0}${h.identifier(c)}${l&&h` ${h.identifier(l)}`} on ${i.on}`)}else r.push(h`${h.raw(i.joinType)} join${s} ${a} on ${i.on}`);n<e.length-1&&r.push(h` `)}return h.join(r)}buildFromTable(e){if(x(e,T)&&e[T.Symbol.OriginalName]!==e[T.Symbol.Name]){let r=h`${h.identifier(e[T.Symbol.OriginalName])}`;return e[T.Symbol.Schema]&&(r=h`${h.identifier(e[T.Symbol.Schema])}.${r}`),h`${r} ${h.identifier(e[T.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:a,table:s,joins:o,orderBy:u,groupBy:c,limit:l,offset:p,lockingClause:d,distinct:m,setOperators:g}){let y=n??ot(r);for(let ue of y)if(x(ue.field,H)&&Ge(ue.field.table)!==(x(s,ve)?s._.alias:x(s,Nn)?s[te].name:x(s,A)?void 0:Ge(s))&&!(be=>o?.some(({alias:At})=>At===(be[T.Symbol.IsAlias]?Ge(be):be[T.Symbol.BaseName])))(ue.field.table)){let be=Ge(ue.field.table);throw new Error(`Your "${ue.path.join("->")}" field references a column "${be}"."${ue.field.name}", but the table "${be}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,k=this.buildWithCTE(e),q;m&&(q=m===!0?h` distinct`:h` distinct on (${h.join(m.on,h`, `)})`);let _=this.buildSelection(y,{isSingleTable:b}),j=this.buildFromTable(s),U=this.buildJoins(o),L=i?h` where ${i}`:void 0,O=a?h` having ${a}`:void 0,M;u&&u.length>0&&(M=h` order by ${h.join(u,h`, `)}`);let ne;c&&c.length>0&&(ne=h` group by ${h.join(c,h`, `)}`);let Oe=typeof l=="object"||typeof l=="number"&&l>=0?h` limit ${l}`:void 0,lt=p?h` offset ${p}`:void 0,Xe=h.empty();if(d){let ue=h` for ${h.raw(d.strength)}`;d.config.of&&ue.append(h` of ${h.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],h`, `)}`),d.config.noWait?ue.append(h` no wait`):d.config.skipLocked&&ue.append(h` skip locked`),Xe.append(ue)}let me=h`${k}select${q} ${_} from ${j}${U}${L}${ne}${O}${M}${Oe}${lt}${Xe}`;return g.length>0?this.buildSetOperations(me,g):me}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:a,orderBy:s,offset:o}}){let u=h`(${e.getSQL()}) `,c=h`(${i.getSQL()})`,l;if(s&&s.length>0){let g=[];for(let y of s)if(x(y,S))g.push(h.identifier(y.name));else if(x(y,A)){for(let b=0;b<y.queryChunks.length;b++){let k=y.queryChunks[b];x(k,S)&&(y.queryChunks[b]=h.identifier(k.name))}g.push(h`${y}`)}else g.push(h`${y}`);l=h` order by ${h.join(g,h`, `)} `}let p=typeof a=="object"||typeof a=="number"&&a>=0?h` limit ${a}`:void 0,d=h.raw(`${r} ${n?"all ":""}`),m=o?h` offset ${o}`:void 0;return h`${u}${d}${c}${l}${p}${m}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:a,select:s,overridingSystemValue_:o}){let u=[],c=e[T.Symbol.Columns],l=Object.entries(c).filter(([k,q])=>!q.shouldDisableInsert()),p=l.map(([,k])=>h.identifier(this.casing.getColumnCasing(k)));if(s){let k=r;x(k,A)?u.push(k):u.push(k.getSQL())}else{let k=r;u.push(h.raw("values "));for(let[q,_]of k.entries()){let j=[];for(let[U,L]of l){let O=_[U];if(O===void 0||x(O,Ke)&&O.value===void 0)if(L.defaultFn!==void 0){let M=L.defaultFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else if(!L.default&&L.onUpdateFn!==void 0){let M=L.onUpdateFn(),ne=x(M,A)?M:h.param(M,L);j.push(ne)}else j.push(h`default`);else j.push(O)}u.push(j),q<k.length-1&&u.push(h`, `)}}let d=this.buildWithCTE(a),m=h.join(u),g=i?h` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,y=n?h` on conflict ${n}`:void 0,b=o===!0?h`overriding system value `:void 0;return h`${d}insert into ${e} ${p} ${b}${m}${y}${g}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?h` concurrently`:void 0,a=n?h` with no data`:void 0;return h`refresh materialized view${i} ${e}${a}`}prepareTyping(e){return x(e,ta)||x(e,ea)?"json":x(e,ra)?"decimal":x(e,na)?"time":x(e,ia)||x(e,aa)?"timestamp":x(e,Ji)||x(e,Yi)?"date":x(e,sa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:a,queryConfig:s,tableAlias:o,nestedQueryRelation:u,joinOn:c}){let l=[],p,d,m=[],g,y=[];if(s===!0)l=Object.entries(a.columns).map(([q,_])=>({dbKey:_.name,tsKey:q,field:_t(_,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let k=Object.fromEntries(Object.entries(a.columns).map(([O,M])=>[O,_t(M,o)]));if(s.where){let O=typeof s.where=="function"?s.where(k,cw()):s.where;g=O&&Ki(O,o)}let q=[],_=[];if(s.columns){let O=!1;for(let[M,ne]of Object.entries(s.columns))ne!==void 0&&M in a.columns&&(!O&&ne===!0&&(O=!0),_.push(M));_.length>0&&(_=O?_.filter(M=>s.columns?.[M]===!0):Object.keys(a.columns).filter(M=>!_.includes(M)))}else _=Object.keys(a.columns);for(let O of _){let M=a.columns[O];q.push({tsKey:O,value:M})}let j=[];s.with&&(j=Object.entries(s.with).filter(O=>!!O[1]).map(([O,M])=>({tsKey:O,queryConfig:M,relation:a.relations[O]})));let U;if(s.extras){U=typeof s.extras=="function"?s.extras(k,{sql:h}):s.extras;for(let[O,M]of Object.entries(U))q.push({tsKey:O,value:ip(M,o)})}for(let{tsKey:O,value:M}of q)l.push({dbKey:x(M,A.Aliased)?M.fieldAlias:a.columns[O].name,tsKey:O,field:x(M,H)?_t(M,o):M,relationTableTsKey:void 0,isJson:!1,selection:[]});let L=typeof s.orderBy=="function"?s.orderBy(k,uw()):s.orderBy??[];Array.isArray(L)||(L=[L]),m=L.map(O=>x(O,H)?_t(O,o):Ki(O,o)),p=s.limit,d=s.offset;for(let{tsKey:O,queryConfig:M,relation:ne}of j){let Oe=pw(r,n,ne),lt=xr(ne.referencedTable),Xe=n[lt],me=`${o}_${O}`,ue=oa(...Oe.fields.map((Un,Co)=>ro(_t(Oe.references[Co],me),_t(Un,o)))),be=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Xe],tableConfig:r[Xe],queryConfig:x(ne,Xt)?M===!0?{limit:1}:{...M,limit:1}:M,tableAlias:me,joinOn:ue,nestedQueryRelation:ne}),At=h`${h.identifier(me)}.${h.identifier("data")}`.as(O);y.push({on:h`true`,table:new ve(be.sql,{},me),alias:me,joinType:"left",lateral:!0}),l.push({dbKey:O,tsKey:O,field:At,relationTableTsKey:Xe,isJson:!0,selection:be.selection})}}if(l.length===0)throw new Xi({message:`No fields selected for table "${a.tsName}" ("${o}")`});let b;if(g=oa(c,g),u){let k=h`json_build_array(${h.join(l.map(({field:j,tsKey:U,isJson:L})=>L?h`${h.identifier(`${o}_${U}`)}.${h.identifier("data")}`:x(j,A.Aliased)?j.sql:j),h`, `)})`;x(u,ca)&&(k=h`coalesce(json_agg(${k}${m.length>0?h` order by ${h.join(m,h`, `)}`:void 0}), '[]'::json)`);let q=[{dbKey:"data",tsKey:"data",field:k.as("data"),isJson:!0,relationTableTsKey:a.tsName,selection:l}];p!==void 0||d!==void 0||m.length>0?(b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:[{path:[],field:h.raw("*")}],where:g,limit:p,offset:d,orderBy:m,setOperators:[]}),g=void 0,p=void 0,d=void 0,m=[]):b=Gi(i,o),b=this.buildSelectQuery({table:x(b,Ce)?b:new ve(b,{},o),fields:{},fieldsFlat:q.map(({field:j})=>({path:[],field:x(j,H)?_t(j,o):j})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]})}else b=this.buildSelectQuery({table:Gi(i,o),fields:{},fieldsFlat:l.map(({field:k})=>({path:[],field:x(k,H)?_t(k,o):k})),joins:y,where:g,limit:p,offset:d,orderBy:m,setOperators:[]});return{tableTsKey:a.tsName,sql:b,selection:l}}};var ao=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var qe=class{static[f]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:x(n,ve)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(a=>[a,n[a]])):x(n,Nn)?i=n[te].selectedFields:x(n,A)?i={}:i=Xs(n),new so({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kd=class extends ao{static[f]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:a,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=a,this._={selectedFields:r},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,a=Ot(r);if(typeof a=="string"&&this.config.joins?.some(s=>s.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof a=="string"&&!x(r,A))){let s=x(r,ve)?r._.selectedFields:x(r,Be)?r[te].selectedFields:r[T.Symbol.Columns];this.config.fields[a]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(F9()):n;if(!Zi(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new de({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new ve(this.getSQL(),this.config.fields,e),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new de({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},so=class extends kd{static[f]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:a,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ee.startActiveSpan("drizzle.prepareQuery",()=>{let o=ot(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=a,u.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};i1(so,[Pe]);function On(t,e){return(r,n,...i)=>{let a=[n,...i].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of a)if(!Zi(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}var F9=()=>({union:B9,unionAll:L9,intersect:z9,intersectAll:$9,except:U9,exceptAll:Q9}),B9=On("union",!1),L9=On("union",!0),z9=On("intersect",!1),$9=On("intersect",!0),U9=On("except",!1),Q9=On("except",!0);var jn=class{static[f]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=x(e,Jt)?e:void 0,this.dialectConfig=x(e,Jt)?void 0:e}$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(n)),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(s){return new qe({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function a(s,o){return new qe({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:i,selectDistinctOn:a}}select(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new qe({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Jt(this.dialectConfig)),this.dialect}};var ua=class{constructor(e,r,n,i,a){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=a}static[f]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},a=this.table[T.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];i[s]=x(o,A)?o:new Ke(o,a[s])}return i});return new oo(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new jn):e;if(!x(r,A)&&!Zi(this.table[Zs],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new oo(this.table,r,this.session,this.dialect,this.withList,!0)}},oo=class extends Pe{constructor(e,r,n,i,a,s,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:a,select:s,overridingSystemValue_:o}}static[f]="PgInsert";config;returning(e=this.config.table[T.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ot(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=h`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?h` where ${e.where}`:void 0;this.config.onConflict=h`(${h.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?h` where ${e.where}`:void 0,n=e.targetWhere?h` where ${e.targetWhere}`:void 0,i=e.setWhere?h` where ${e.setWhere}`:void 0,a=this.dialect.buildUpdateSet(this.config.table,Ws(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=h`(${h.raw(s)})${n} do update set ${a}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var co=class extends Pe{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[f]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var la=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[f]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Ed(this.table,Ws(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Ed=class extends Pe{constructor(e,r,n,i,a){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:a,joins:[]},this.tableName=Ot(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[f]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Ot(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return x(e,Ce)?e[T.Symbol.Columns]:x(e,ve)?e._.selectedFields:e[te].selectedFields}createJoin(e){return(r,n)=>{let i=Ot(r);if(typeof i=="string"&&this.config.joins.some(a=>a.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let a=this.config.from&&!x(this.config.from,A)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[T.Symbol.Columns],new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new de({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[T.Symbol.Columns]),this.config.from)){let r=Ot(this.config.from);if(typeof r=="string"&&this.config.from&&!x(this.config.from,A)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Ot(n.table);if(typeof i=="string"&&!x(n.table,A)){let a=this.getTableLikeFields(n.table);e[i]=a}}}return this.config.returningFields=e,this.config.returning=ot(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new de({alias:Ge(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var uo=class t extends A{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[f]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return h`(select count(*) from ${e}${h.raw(" where ").if(r)}${r})`}static buildCount(e,r){return h`select count(*) as count from ${e}${h.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var lo=class{constructor(e,r,n,i,a,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o}static[f]="PgRelationalQueryBuilder";findMany(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new po(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},po=class extends Pe{constructor(e,r,n,i,a,s,o,u,c){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=a,this.dialect=s,this.session=o,this.config=u,this.mode=c}static[f]="PgRelationalQuery";_prepare(e){return ee.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,a)=>{let s=i.map(o=>io(this.schema,this.tableConfig,o,r.selection,a));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ee.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fo=class extends Pe{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[f]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var In=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,a]of Object.entries(this._.schema))this.query[i]=new lo(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],a,e,r)}static[f]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:a=>(typeof a=="function"&&(a=a(new jn(n.dialect))),new Proxy(new Pn(a.getSQL(),r??("getSelectedFields"in a?a.getSelectedFields()??{}:{}),e,!0),new de({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new uo({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(c){return new qe({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function a(c,l){return new qe({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:c}})}function s(c){return new la(c,r.session,r.dialect,e)}function o(c){return new ua(c,r.session,r.dialect,e)}function u(c){return new Wi(c,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:a,update:s,insert:o,delete:u}}select(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new qe({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new qe({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new la(e,this.session,this.dialect)}insert(e){return new ua(e,this.session,this.dialect)}delete(e){return new Wi(e,this.session,this.dialect)}refreshMaterializedView(e){return new co(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?h.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fo(()=>i.execute(void 0,this.authToken),r,n,a=>i.mapResult(a,!0))}transaction(e,r){return this.session.transaction(e,r)}};var mo=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[f]="PgPreparedQuery";joinsNotNullableMap},ho=class{constructor(e){this.dialect=e}static[f]="PgSession";execute(e,r){return ee.startActiveSpan("drizzle.operation",()=>ee.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},vo=class extends In{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[f]="PgTransaction";rollback(){throw new Ys}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),h.raw(r.join(" "))}setTransaction(e){return this.session.execute(h`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:fw,types:Et}=Wt,Td=class extends mo{constructor(e,r,n,i,a,s,o,u){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=a,this._isResponseInArrayMode=o,this.customResultMapper=u,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(c,l)=>c===Et.builtins.TIMESTAMPTZ?p=>p:c===Et.builtins.TIMESTAMP?p=>p:c===Et.builtins.DATE?p=>p:c===Et.builtins.INTERVAL?p=>p:Et.getTypeParser(c,l)}}}static[f]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return ee.startActiveSpan("drizzle.execute",async()=>{let r=np(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:i,client:a,queryConfig:s,joinsNotNullableMap:o,customResultMapper:u}=this;if(!n&&!u)return ee.startActiveSpan("drizzle.driver.execute",async l=>(l?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(r)}),a.query(i,r)));let c=await ee.startActiveSpan("drizzle.driver.execute",l=>(l?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),a.query(s,r)));return ee.startActiveSpan("drizzle.mapResponse",()=>u?u(c.rows):c.rows.map(l=>n1(n,l,o)))})}all(e={}){return ee.startActiveSpan("drizzle.execute",()=>{let r=np(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),ee.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},go=class t extends ho{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Qs}static[f]="NodePgSession";logger;prepareQuery(e,r,n,i,a){return new Td(this.client,e.sql,e.params,this.logger,r,n,i,a)}async transaction(e,r){let n=this.client instanceof fw?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Cd(this.dialect,n,this.schema);await i.execute(h`begin${r?h` ${i.getTransactionConfigSQL(r)}`:void 0}`);try{let a=await e(i);return await i.execute(h`commit`),a}catch(a){throw await i.execute(h`rollback`),a}finally{this.client instanceof fw&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Cd=class t extends vo{static[f]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(h.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(h.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(h.raw(`rollback to savepoint ${r}`)),i}}};var Ad=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[f]="NodePgDriver";createSession(e){return new go(this.client,this.dialect,e,{logger:this.options.logger})}},Pd=class extends In{static[f]="NodePgDatabase"};function pa(t,e={}){let r=new Jt({casing:e.casing}),n;e.logger===!0?n=new Us:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let u=lw(e.schema,dw);i={fullSchema:e.schema,schema:u.tables,tableNamesMap:u.tableNamesMap}}let s=new Ad(t,r,{logger:n}).createSession(i),o=new Pd(r,s,i);return o.$client=t,o}function yo(...t){if(typeof t[0]=="string"){let e=new Wt.Pool({connectionString:t[0]});return pa(e,t[1])}if(s1(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return pa(r,n);let i=typeof e=="string"?new Wt.Pool({connectionString:e}):new Wt.Pool(e);return pa(i,n)}return pa(t[0],t[1])}(t=>{function e(r){return pa({},r)}t.mock=e})(yo||(yo={}));var Rd={};zd(Rd,{insertServiceSchema:()=>oq,services:()=>ga});var Q;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let a={};for(let s of i)a[s]=s;return a},t.getValidEnumValues=i=>{let a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(let o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let a=[];for(let s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(let s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=n,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Q||(Q={}));var Nd;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Nd||(Nd={}));var C=Q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}},w=Q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),V9=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),et=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(a){return a.message},n={_errors:[]},i=a=>{for(let s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let o=n,u=0;for(;u<s.path.length;){let c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(r(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};et.create=t=>new et(t);var Mn=(t,e)=>{let r;switch(t.code){case w.invalid_type:t.received===C.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,Q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:r=`Unrecognized key(s) in object: ${Q.joinValues(t.keys,", ")}`;break;case w.invalid_union:r="Invalid input";break;case w.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Q.joinValues(t.options)}`;break;case w.invalid_enum_value:r=`Invalid enum value. Expected ${Q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:r="Invalid function arguments";break;case w.invalid_return_type:r="Invalid function return type";break;case w.invalid_date:r="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:Q.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case w.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case w.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case w.custom:r="Invalid input";break;case w.invalid_intersection_types:r="Intersection results could not be merged";break;case w.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:r="Number must be finite";break;default:r=e.defaultError,Q.assertNever(t)}return{message:r}},gw=Mn;function H9(t){gw=t}function xo(){return gw}var bo=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,a=[...r,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="",u=n.filter(c=>!!c).slice().reverse();for(let c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}},G9=[];function E(t,e){let r=xo(),n=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===Mn?void 0:Mn].filter(i=>!!i)});t.common.issues.push(n)}var Ne=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let a=await i.key,s=await i.value;n.push({key:a,value:s})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(n[a.value]=s.value)}return{status:e.value,value:n}}},R=Object.freeze({status:"aborted"}),Dn=t=>({status:"dirty",value:t}),Le=t=>({status:"valid",value:t}),Od=t=>t.status==="aborted",jd=t=>t.status==="dirty",Sr=t=>t.status==="valid",ma=t=>typeof Promise<"u"&&t instanceof Promise;function wo(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function yw(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}));var da,fa,ut=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mw=(t,e)=>{if(Sr(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new et(t.common.issues);return this._error=r,this._error}}};function F(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{var u,c;let{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??n)!==null&&u!==void 0?u:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??r)!==null&&c!==void 0?c:o.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return Rt(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ne,ctx:{common:e.parent.common,data:e.data,parsedType:Rt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ma(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return mw(i,a)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)};if(!this["~standard"].async)try{let a=this._parseSync({data:e,path:[],parent:i});return Sr(a)?{value:a.value}:{issues:i.common.issues}}catch(a){!((n=(r=a?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(a=>Sr(a)?{value:a.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Rt(e)},i=this._parse({data:e,path:n.path,parent:n}),a=await(ma(i)?i:Promise.resolve(i));return mw(n,a)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,a)=>{let s=e(i),o=()=>a.addIssue({code:w.custom,...n(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new tt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return ct.create(this,this._def)}nullable(){return Ct.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Mt.create(this)}promise(){return tr.create(this,this._def)}or(e){return Pr.create([this,e],this._def)}and(e){return qr.create(this,e,this._def)}transform(e){return new tt({...F(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Rr({...F(this._def),innerType:this,defaultValue:r,typeName:I.ZodDefault})}brand(){return new ha({typeName:I.ZodBranded,type:this,...F(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Dr({...F(this._def),innerType:this,catchValue:r,typeName:I.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return va.create(this,e)}readonly(){return Mr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K9=/^c[^\s-]{8,}$/i,Z9=/^[0-9a-z]+$/,W9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,X9=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,J9=/^[a-z0-9_-]{21}$/i,Y9=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,eP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,tP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",qd,nP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,oP=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uP=new RegExp(`^${xw}$`);function bw(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function lP(t){return new RegExp(`^${bw(t)}$`)}function ww(t){let e=`${xw}T${bw(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function pP(t,e){return!!((e==="v4"||!e)&&nP.test(t)||(e==="v6"||!e)&&aP.test(t))}function dP(t,e){if(!Y9.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function fP(t,e){return!!((e==="v4"||!e)&&iP.test(t)||(e==="v6"||!e)&&sP.test(t))}var Yt=class t extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.string,received:a.parsedType}),R}let n=new Ne,i;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){let s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?E(i,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&E(i,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")tP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"email",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")qd||(qd=new RegExp(rP,"u")),qd.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"emoji",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")X9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"uuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")J9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"nanoid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")K9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")Z9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cuid2",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")W9.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ulid",code:w.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),E(i,{validation:"url",code:w.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"regex",code:w.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?ww(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?uP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?lP(a).test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{code:w.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?eP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"duration",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?pP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"ip",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?dP(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"jwt",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?fP(e.data,a.version)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"cidr",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?oP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64",code:w.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?cP.test(e.data)||(i=this._getOrReturnCtx(e,i),E(i,{validation:"base64url",code:w.invalid_string,message:a.message}),n.dirty()):Q.assertNever(a);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:w.invalid_string,...N.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...N.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...N.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...N.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...N.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...N.errToObj(r)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Yt.create=t=>{var e;return new Yt({checks:[],typeName:I.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};function mP(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,a=parseInt(t.toFixed(i).replace(".","")),s=parseInt(e.toFixed(i).replace(".",""));return a%s/Math.pow(10,i)}var _r=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.number,received:a.parsedType}),R}let n,i=new Ne;for(let a of this._def.checks)a.kind==="int"?Q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?mP(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_finite,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Q.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};_r.create=t=>new _r({checks:[],typeName:I.ZodNumber,coerce:t?.coerce||!1,...F(t)});var kr=class t extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let n,i=new Ne;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),E(n,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Q.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.bigint,received:r.parsedType}),R}gte(e,r){return this.setLimit("min",e,!0,N.toString(r))}gt(e,r){return this.setLimit("min",e,!1,N.toString(r))}lte(e,r){return this.setLimit("max",e,!0,N.toString(r))}lt(e,r){return this.setLimit("max",e,!1,N.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:N.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};kr.create=t=>{var e;return new kr({checks:[],typeName:I.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...F(t)})};var Er=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.boolean,received:n.parsedType}),R}return Le(e.data)}};Er.create=t=>new Er({typeName:I.ZodBoolean,coerce:t?.coerce||!1,...F(t)});var Tr=class t extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_type,expected:C.date,received:a.parsedType}),R}if(isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return E(a,{code:w.invalid_date}),R}let n=new Ne,i;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),E(i,{code:w.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Q.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};Tr.create=t=>new Tr({checks:[],coerce:t?.coerce||!1,typeName:I.ZodDate,...F(t)});var Fn=class extends B{_parse(e){if(this._getType(e)!==C.symbol){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.symbol,received:n.parsedType}),R}return Le(e.data)}};Fn.create=t=>new Fn({typeName:I.ZodSymbol,...F(t)});var Cr=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.undefined,received:n.parsedType}),R}return Le(e.data)}};Cr.create=t=>new Cr({typeName:I.ZodUndefined,...F(t)});var Ar=class extends B{_parse(e){if(this._getType(e)!==C.null){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.null,received:n.parsedType}),R}return Le(e.data)}};Ar.create=t=>new Ar({typeName:I.ZodNull,...F(t)});var er=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return Le(e.data)}};er.create=t=>new er({typeName:I.ZodAny,...F(t)});var Dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Le(e.data)}};Dt.create=t=>new Dt({typeName:I.ZodUnknown,...F(t)});var ht=class extends B{_parse(e){let r=this._getOrReturnCtx(e);return E(r,{code:w.invalid_type,expected:C.never,received:r.parsedType}),R}};ht.create=t=>new ht({typeName:I.ZodNever,...F(t)});var Bn=class extends B{_parse(e){if(this._getType(e)!==C.undefined){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.void,received:n.parsedType}),R}return Le(e.data)}};Bn.create=t=>new Bn({typeName:I.ZodVoid,...F(t)});var Mt=class t extends B{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==C.array)return E(r,{code:w.invalid_type,expected:C.array,received:r.parsedType}),R;if(i.exactLength!==null){let s=r.data.length>i.exactLength.value,o=r.data.length<i.exactLength.value;(s||o)&&(E(r,{code:s?w.too_big:w.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(E(r,{code:w.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(E(r,{code:w.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((s,o)=>i.type._parseAsync(new ut(r,s,r.path,o)))).then(s=>Ne.mergeArray(n,s));let a=[...r.data].map((s,o)=>i.type._parseSync(new ut(r,s,r.path,o)));return Ne.mergeArray(n,a)}get element(){return this._def.type}min(e,r){return new t({...this._def,minLength:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxLength:{value:e,message:N.toString(r)}})}length(e,r){return new t({...this._def,exactLength:{value:e,message:N.toString(r)}})}nonempty(e){return this.min(1,e)}};Mt.create=(t,e)=>new Mt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...F(e)});function Rn(t){if(t instanceof We){let e={};for(let r in t.shape){let n=t.shape[r];e[r]=ct.create(Rn(n))}return new We({...t._def,shape:()=>e})}else return t instanceof Mt?new Mt({...t._def,type:Rn(t.element)}):t instanceof ct?ct.create(Rn(t.unwrap())):t instanceof Ct?Ct.create(Rn(t.unwrap())):t instanceof Tt?Tt.create(t.items.map(e=>Rn(e))):t}var We=class t extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),r=Q.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==C.object){let c=this._getOrReturnCtx(e);return E(c,{code:w.invalid_type,expected:C.object,received:c.parsedType}),R}let{status:n,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(let c in i.data)s.includes(c)||o.push(c);let u=[];for(let c of s){let l=a[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ut(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof ht){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(E(i,{code:w.unrecognized_keys,keys:o}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let p=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ut(i,p,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let p=await l.key,d=await l.value;c.push({key:p,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>Ne.mergeObjectSync(n,c)):Ne.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,n)=>{var i,a,s,o;let u=(s=(a=(i=this._def).errorMap)===null||a===void 0?void 0:a.call(i,r,n).message)!==null&&s!==void 0?s:n.defaultError;return r.code==="unrecognized_keys"?{message:(o=N.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let r={};return Q.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}omit(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{e[n]||(r[n]=this.shape[n])}),new t({...this._def,shape:()=>r})}deepPartial(){return Rn(this)}partial(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{let i=this.shape[n];e&&!e[n]?r[n]=i:r[n]=i.optional()}),new t({...this._def,shape:()=>r})}required(e){let r={};return Q.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])r[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ct;)a=a._def.innerType;r[n]=a}}),new t({...this._def,shape:()=>r})}keyof(){return Sw(Q.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:ht.create(),typeName:I.ZodObject,...F(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:ht.create(),typeName:I.ZodObject,...F(e)});var Pr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=this._def.options;function i(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;let s=a.map(o=>new et(o.ctx.common.issues));return E(r,{code:w.invalid_union,unionErrors:s}),R}if(r.common.async)return Promise.all(n.map(async a=>{let s={...r,common:{...r.common,issues:[]},parent:null};return{result:await a._parseAsync({data:r.data,path:r.path,parent:s}),ctx:s}})).then(i);{let a,s=[];for(let u of n){let c={...r,common:{...r.common,issues:[]},parent:null},l=u._parseSync({data:r.data,path:r.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!a&&(a={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return r.common.issues.push(...a.ctx.common.issues),a.result;let o=s.map(u=>new et(u));return E(r,{code:w.invalid_union,unionErrors:o}),R}}get options(){return this._def.options}};Pr.create=(t,e)=>new Pr({options:t,typeName:I.ZodUnion,...F(e)});var It=t=>t instanceof Nr?It(t.schema):t instanceof tt?It(t.innerType()):t instanceof Or?[t.value]:t instanceof jr?t.options:t instanceof Ir?Q.objectValues(t.enum):t instanceof Rr?It(t._def.innerType):t instanceof Cr?[void 0]:t instanceof Ar?[null]:t instanceof ct?[void 0,...It(t.unwrap())]:t instanceof Ct?[null,...It(t.unwrap())]:t instanceof ha||t instanceof Mr?It(t.unwrap()):t instanceof Dr?It(t._def.innerType):[],So=class t extends B{_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return E(r,{code:w.invalid_type,expected:C.object,received:r.parsedType}),R;let n=this.discriminator,i=r.data[n],a=this.optionsMap.get(i);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(E(r,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,n){let i=new Map;for(let a of r){let s=It(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new t({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:i,...F(n)})}};function Id(t,e){let r=Rt(t),n=Rt(e);if(t===e)return{valid:!0,data:t};if(r===C.object&&n===C.object){let i=Q.objectKeys(e),a=Q.objectKeys(t).filter(o=>i.indexOf(o)!==-1),s={...t,...e};for(let o of a){let u=Id(t[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(r===C.array&&n===C.array){if(t.length!==e.length)return{valid:!1};let i=[];for(let a=0;a<t.length;a++){let s=t[a],o=e[a],u=Id(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return r===C.date&&n===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var qr=class extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=(a,s)=>{if(Od(a)||Od(s))return R;let o=Id(a.value,s.value);return o.valid?((jd(a)||jd(s))&&r.dirty(),{status:r.value,value:o.data}):(E(n,{code:w.invalid_intersection_types}),R)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};qr.create=(t,e,r)=>new qr({left:t,right:e,typeName:I.ZodIntersection,...F(r)});var Tt=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return E(n,{code:w.invalid_type,expected:C.array,received:n.parsedType}),R;if(n.data.length<this._def.items.length)return E(n,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let a=[...n.data].map((s,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ut(n,s,n.path,o)):null}).filter(s=>!!s);return n.common.async?Promise.all(a).then(s=>Ne.mergeArray(r,s)):Ne.mergeArray(r,a)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Tt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tt({items:t,typeName:I.ZodTuple,rest:null,...F(e)})};var _o=class t extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return E(n,{code:w.invalid_type,expected:C.object,received:n.parsedType}),R;let i=[],a=this._def.keyType,s=this._def.valueType;for(let o in n.data)i.push({key:a._parse(new ut(n,o,n.path,o)),value:s._parse(new ut(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?Ne.mergeObjectAsync(r,i):Ne.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(e,r,n){return r instanceof B?new t({keyType:e,valueType:r,typeName:I.ZodRecord,...F(n)}):new t({keyType:Yt.create(),valueType:e,typeName:I.ZodRecord,...F(r)})}},Ln=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return E(n,{code:w.invalid_type,expected:C.map,received:n.parsedType}),R;let i=this._def.keyType,a=this._def.valueType,s=[...n.data.entries()].map(([o,u],c)=>({key:i._parse(new ut(n,o,n.path,[c,"key"])),value:a._parse(new ut(n,u,n.path,[c,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of s){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}})}else{let o=new Map;for(let u of s){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return R;(c.status==="dirty"||l.status==="dirty")&&r.dirty(),o.set(c.value,l.value)}return{status:r.value,value:o}}}};Ln.create=(t,e,r)=>new Ln({valueType:e,keyType:t,typeName:I.ZodMap,...F(r)});var zn=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return E(n,{code:w.invalid_type,expected:C.set,received:n.parsedType}),R;let i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(E(n,{code:w.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(E(n,{code:w.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());let a=this._def.valueType;function s(u){let c=new Set;for(let l of u){if(l.status==="aborted")return R;l.status==="dirty"&&r.dirty(),c.add(l.value)}return{status:r.value,value:c}}let o=[...n.data.values()].map((u,c)=>a._parse(new ut(n,u,n.path,c)));return n.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,r){return new t({...this._def,minSize:{value:e,message:N.toString(r)}})}max(e,r){return new t({...this._def,maxSize:{value:e,message:N.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}};zn.create=(t,e)=>new zn({valueType:t,minSize:null,maxSize:null,typeName:I.ZodSet,...F(e)});var ko=class t extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.function)return E(r,{code:w.invalid_type,expected:C.function,received:r.parsedType}),R;function n(o,u){return bo({data:o,path:r.path,errorMaps:[r.comm
on.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:u}})}function i(o,u){return bo({data:o,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xo(),Mn].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:u}})}let a={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof tr){let o=this;return Le(async function(...u){let c=new et([]),l=await o._def.args.parseAsync(u,a).catch(m=>{throw c.addIssue(n(u,m)),c}),p=await Reflect.apply(s,this,l);return await o._def.returns._def.type.parseAsync(p,a).catch(m=>{throw c.addIssue(i(p,m)),c})})}else{let o=this;return Le(function(...u){let c=o._def.args.safeParse(u,a);if(!c.success)throw new et([n(u,c.error)]);let l=Reflect.apply(s,this,c.data),p=o._def.returns.safeParse(l,a);if(!p.success)throw new et([i(l,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Tt.create(e).rest(Dt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,n){return new t({args:e||Tt.create([]).rest(Dt.create()),returns:r||Dt.create(),typeName:I.ZodFunction,...F(n)})}},Nr=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Nr.create=(t,e)=>new Nr({getter:t,typeName:I.ZodLazy,...F(e)});var Or=class extends B{_parse(e){if(e.data!==this._def.value){let r=this._getOrReturnCtx(e);return E(r,{received:r.data,code:w.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}};Or.create=(t,e)=>new Or({value:t,typeName:I.ZodLiteral,...F(e)});function Sw(t,e){return new jr({values:t,typeName:I.ZodEnum,...F(e)})}var jr=class t extends B{constructor(){super(...arguments),da.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{expected:Q.joinValues(n),received:r.parsedType,code:w.invalid_type}),R}if(wo(this,da,"f")||yw(this,da,new Set(this._def.values),"f"),!wo(this,da,"f").has(e.data)){let r=this._getOrReturnCtx(e),n=this._def.values;return E(r,{received:r.data,code:w.invalid_enum_value,options:n}),R}return Le(e.data)}get options(){return this._def.values}get enum(){let e={};for(let r of this._def.values)e[r]=r;return e}get Values(){let e={};for(let r of this._def.values)e[r]=r;return e}get Enum(){let e={};for(let r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return t.create(e,{...this._def,...r})}exclude(e,r=this._def){return t.create(this.options.filter(n=>!e.includes(n)),{...this._def,...r})}};da=new WeakMap;jr.create=Sw;var Ir=class extends B{constructor(){super(...arguments),fa.set(this,void 0)}_parse(e){let r=Q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){let i=Q.objectValues(r);return E(n,{expected:Q.joinValues(i),received:n.parsedType,code:w.invalid_type}),R}if(wo(this,fa,"f")||yw(this,fa,new Set(Q.getValidEnumValues(this._def.values)),"f"),!wo(this,fa,"f").has(e.data)){let i=Q.objectValues(r);return E(n,{received:n.data,code:w.invalid_enum_value,options:i}),R}return Le(e.data)}get enum(){return this._def.values}};fa=new WeakMap;Ir.create=(t,e)=>new Ir({values:t,typeName:I.ZodNativeEnum,...F(e)});var tr=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:r}=this._processInputParams(e);if(r.parsedType!==C.promise&&r.common.async===!1)return E(r,{code:w.invalid_type,expected:C.promise,received:r.parsedType}),R;let n=r.parsedType===C.promise?r.data:Promise.resolve(r.data);return Le(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};tr.create=(t,e)=>new tr({type:t,typeName:I.ZodPromise,...F(e)});var tt=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:r,ctx:n}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{E(n,s),s.fatal?r.abort():r.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){let s=i.transform(n.data,a);if(n.common.async)return Promise.resolve(s).then(async o=>{if(r.value==="aborted")return R;let u=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?R:u.status==="dirty"||r.value==="dirty"?Dn(u.value):u});{if(r.value==="aborted")return R;let o=this._def.schema._parseSync({data:s,path:n.path,parent:n});return o.status==="aborted"?R:o.status==="dirty"||r.value==="dirty"?Dn(o.value):o}}if(i.type==="refinement"){let s=o=>{let u=i.refinement(o,a);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?R:(o.status==="dirty"&&r.dirty(),s(o.value).then(()=>({status:r.value,value:o.value}))))}if(i.type==="transform")if(n.common.async===!1){let s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Sr(s))return s;let o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>Sr(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:r.value,value:o})):s);Q.assertNever(i)}};tt.create=(t,e,r)=>new tt({schema:t,typeName:I.ZodEffects,effect:e,...F(r)});tt.createWithPreprocess=(t,e,r)=>new tt({schema:e,effect:{type:"preprocess",transform:t},typeName:I.ZodEffects,...F(r)});var ct=class extends B{_parse(e){return this._getType(e)===C.undefined?Le(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ct.create=(t,e)=>new ct({innerType:t,typeName:I.ZodOptional,...F(e)});var Ct=class extends B{_parse(e){return this._getType(e)===C.null?Le(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ct.create=(t,e)=>new Ct({innerType:t,typeName:I.ZodNullable,...F(e)});var Rr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return r.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Rr.create=(t,e)=>new Rr({innerType:t,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...F(e)});var Dr=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ma(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new et(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Dr.create=(t,e)=>new Dr({innerType:t,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...F(e)});var $n=class extends B{_parse(e){if(this._getType(e)!==C.nan){let n=this._getOrReturnCtx(e);return E(n,{code:w.invalid_type,expected:C.nan,received:n.parsedType}),R}return{status:"valid",value:e.data}}};$n.create=t=>new $n({typeName:I.ZodNaN,...F(t)});var hP=Symbol("zod_brand"),ha=class extends B{_parse(e){let{ctx:r}=this._processInputParams(e),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},va=class t extends B{_parse(e){let{status:r,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?R:a.status==="dirty"?(r.dirty(),Dn(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{let i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?R:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(e,r){return new t({in:e,out:r,typeName:I.ZodPipeline})}},Mr=class extends B{_parse(e){let r=this._def.innerType._parse(e),n=i=>(Sr(i)&&(i.value=Object.freeze(i.value)),i);return ma(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};Mr.create=(t,e)=>new Mr({innerType:t,typeName:I.ZodReadonly,...F(e)});function hw(t,e){let r=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof r=="string"?{message:r}:r}function _w(t,e={},r){return t?er.create().superRefine((n,i)=>{var a,s;let o=t(n);if(o instanceof Promise)return o.then(u=>{var c,l;if(!u){let p=hw(e,n),d=(l=(c=p.fatal)!==null&&c!==void 0?c:r)!==null&&l!==void 0?l:!0;i.addIssue({code:"custom",...p,fatal:d})}});if(!o){let u=hw(e,n),c=(s=(a=u.fatal)!==null&&a!==void 0?a:r)!==null&&s!==void 0?s:!0;i.addIssue({code:"custom",...u,fatal:c})}}):er.create()}var vP={object:We.lazycreate},I;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(I||(I={}));var gP=(t,e={message:`Input not instance of ${t.name}`})=>_w(r=>r instanceof t,e),kw=Yt.create,Ew=_r.create,yP=$n.create,xP=kr.create,Tw=Er.create,bP=Tr.create,wP=Fn.create,SP=Cr.create,_P=Ar.create,kP=er.create,EP=Dt.create,TP=ht.create,CP=Bn.create,AP=Mt.create,PP=We.create,qP=We.strictCreate,NP=Pr.create,OP=So.create,jP=qr.create,IP=Tt.create,RP=_o.create,DP=Ln.create,MP=zn.create,FP=ko.create,BP=Nr.create,LP=Or.create,zP=jr.create,$P=Ir.create,UP=tr.create,vw=tt.create,QP=ct.create,VP=Ct.create,HP=tt.createWithPreprocess,GP=va.create,KP=()=>kw().optional(),ZP=()=>Ew().optional(),WP=()=>Tw().optional(),XP={string:(t=>Yt.create({...t,coerce:!0})),number:(t=>_r.create({...t,coerce:!0})),boolean:(t=>Er.create({...t,coerce:!0})),bigint:(t=>kr.create({...t,coerce:!0})),date:(t=>Tr.create({...t,coerce:!0}))},JP=R,ye=Object.freeze({__proto__:null,defaultErrorMap:Mn,setErrorMap:H9,getErrorMap:xo,makeIssue:bo,EMPTY_PATH:G9,addIssueToContext:E,ParseStatus:Ne,INVALID:R,DIRTY:Dn,OK:Le,isAborted:Od,isDirty:jd,isValid:Sr,isAsync:ma,get util(){return Q},get objectUtil(){return Nd},ZodParsedType:C,getParsedType:Rt,ZodType:B,datetimeRegex:ww,ZodString:Yt,ZodNumber:_r,ZodBigInt:kr,ZodBoolean:Er,ZodDate:Tr,ZodSymbol:Fn,ZodUndefined:Cr,ZodNull:Ar,ZodAny:er,ZodUnknown:Dt,ZodNever:ht,ZodVoid:Bn,ZodArray:Mt,ZodObject:We,ZodUnion:Pr,ZodDiscriminatedUnion:So,ZodIntersection:qr,ZodTuple:Tt,ZodRecord:_o,ZodMap:Ln,ZodSet:zn,ZodFunction:ko,ZodLazy:Nr,ZodLiteral:Or,ZodEnum:jr,ZodNativeEnum:Ir,ZodPromise:tr,ZodEffects:tt,ZodTransformer:tt,ZodOptional:ct,ZodNullable:Ct,ZodDefault:Rr,ZodCatch:Dr,ZodNaN:$n,BRAND:hP,ZodBranded:ha,ZodPipeline:va,ZodReadonly:Mr,custom:_w,Schema:B,ZodSchema:B,late:vP,get ZodFirstPartyTypeKind(){return I},coerce:XP,any:kP,array:AP,bigint:xP,boolean:Tw,date:bP,discriminatedUnion:OP,effect:vw,enum:zP,function:FP,instanceof:gP,intersection:jP,lazy:BP,literal:LP,map:DP,nan:yP,nativeEnum:$P,never:TP,null:_P,nullable:VP,number:Ew,object:PP,oboolean:WP,onumber:ZP,optional:QP,ostring:KP,pipeline:GP,preprocess:HP,promise:UP,record:RP,set:MP,strictObject:qP,string:kw,symbol:wP,transformer:vw,tuple:IP,undefined:SP,union:NP,unknown:EP,void:CP,NEVER:JP,ZodIssueCode:w,quotelessJson:V9,ZodError:et});var ce={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function fe(t,e){return e.includes(t.columnType)}function YP(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var eq=ye.union([ye.string(),ye.number(),ye.boolean(),ye.null()]),tq=ye.union([eq,ye.record(ye.any()),ye.array(ye.any())]),rq=ye.custom(t=>t instanceof Buffer);function Cw(t,e){let r=e?.zodInstance??ye,n=e?.coerce??{},i;return YP(t)&&(i=t.enumValues.length?r.enum(t.enumValues):r.string()),i||(fe(t,["PgGeometry","PgPointTuple"])?i=r.tuple([r.number(),r.number()]):fe(t,["PgGeometryObject","PgPointObject"])?i=r.object({x:r.number(),y:r.number()}):fe(t,["PgHalfVector","PgVector"])?(i=r.array(r.number()),i=t.dimensions?i.length(t.dimensions):i):fe(t,["PgLine"])?i=r.tuple([r.number(),r.number(),r.number()]):fe(t,["PgLineABC"])?i=r.object({a:r.number(),b:r.number(),c:r.number()}):fe(t,["PgArray"])?(i=r.array(Cw(t.baseColumn,r)),i=t.size?i.length(t.size):i):t.dataType==="array"?i=r.array(r.any()):t.dataType==="number"?i=nq(t,r,n):t.dataType==="bigint"?i=iq(t,r,n):t.dataType==="boolean"?i=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?i=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?i=aq(t,r,n):t.dataType==="json"?i=tq:t.dataType==="custom"?i=r.any():t.dataType==="buffer"&&(i=rq)),i||(i=r.any()),i}function nq(t,e,r){let n=t.getSQLType().includes("unsigned"),i,a,s=!1;fe(t,["MySqlTinyInt","SingleStoreTinyInt"])?(i=n?0:ce.INT8_MIN,a=n?ce.INT8_UNSIGNED_MAX:ce.INT8_MAX,s=!0):fe(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=n?0:ce.INT16_MIN,a=n?ce.INT16_UNSIGNED_MAX:ce.INT16_MAX,s=!0):fe(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=n?0:ce.INT24_MIN,a=n?ce.INT24_UNSIGNED_MAX:ce.INT24_MAX,s=fe(t,["MySqlMediumInt","SingleStoreMediumInt"])):fe(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=n?0:ce.INT32_MIN,a=n?ce.INT32_UNSIGNED_MAX:ce.INT32_MAX,s=!0):fe(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=n?0:ce.INT48_MIN,a=n?ce.INT48_UNSIGNED_MAX:ce.INT48_MAX):fe(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||fe(t,["MySqlSerial","SingleStoreSerial"]),i=n?0:Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=!0):fe(t,["MySqlYear","SingleStoreYear"])?(i=1901,a=2155,s=!0):(i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(i).max(a),s?o.int():o}function iq(t,e,r){let n=t.getSQLType().includes("unsigned"),i=n?0n:ce.INT64_MIN,a=n?ce.INT64_UNSIGNED_MAX:ce.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(i).max(a)}function aq(t,e,r){if(fe(t,["PgUUID"]))return e.string().uuid();let n,i,a=!1;fe(t,["PgVarchar","SQLiteText"])?n=t.length:fe(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??ce.INT16_UNSIGNED_MAX:fe(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=ce.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=ce.INT24_UNSIGNED_MAX:t.textType==="text"?n=ce.INT16_UNSIGNED_MAX:n=ce.INT8_UNSIGNED_MAX),fe(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,a=!0),fe(t,["PgBinaryVector"])&&(i=/^[01]+$/,n=t.dimensions);let s=r===!0||r?.string?e.coerce.string():e.string();return s=i?s.regex(i):s,n&&a?s.length(n):n?s.max(n):s}function Aw(t){return tp(t)?Xs(t):a1(t)}function Pw(t,e,r,n){let i={};for(let[a,s]of Object.entries(t)){if(!x(s,H)&&!x(s,A)&&!x(s,A.Aliased)&&typeof s=="object"){let p=tp(s)||t1(s)?Aw(s):s;i[a]=Pw(p,e[a]??{},r,n);continue}let o=e[a];if(o!==void 0&&typeof o!="function"){i[a]=o;continue}let u=x(s,H)?s:void 0,c=u?Cw(u,n):ye.any(),l=typeof o=="function"?o(c):c;r.never(u)||(i[a]=l,u&&(r.nullable(u)&&(i[a]=i[a].nullable()),r.optional(u)&&(i[a]=i[a].optional())))}return ye.object(i)}var sq={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var qw=(t,e)=>{let r=Aw(t);return Pw(r,e??{},sq)};var ga=L1("services",{id:eo("id").primaryKey(),title:wr("title").notNull(),description:wr("description").notNull(),category:wr("category").notNull(),icon:wr("icon").notNull()}),oq=qw(ga).omit({id:!0});var{Pool:cq}=Wt;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var uq=new cq({connectionString:process.env.DATABASE_URL}),Dd=yo(uq,{schema:Rd});var Md=class{async getServices(){return await Dd.select().from(ga)}async createService(e){let[r]=await Dd.insert(ga).values(e).returning();return r}},Eo=new Md;var MB={internal:ye.object({message:ye.string()})},Nw={services:{list:{method:"GET",path:"/api/services",responses:{200:ye.array(ye.custom())}}}};async function lq(){if((await Eo.getServices()).length===0){let e=[{title:"Guarda",description:"Prote\xE7\xE3o e bem-estar dos filhos e menores.",category:"Fam\xEDlia",icon:"Shield"},{title:"Investiga\xE7\xE3o de Paternidade",description:"Reconhecimento biol\xF3gico e garantia de direitos.",category:"Fam\xEDlia",icon:"Search"},{title:"Div\xF3rcio",description:"Atua\xE7\xE3o em div\xF3rcios judiciais e extrajudiciais.",category:"Fam\xEDlia",icon:"HeartCrack"},{title:"Regulariza\xE7\xE3o de Im\xF3vel",description:"Regulariza\xE7\xE3o documental e usucapi\xE3o.",category:"Civil",icon:"Home"},{title:"Indeniza\xE7\xE3o",description:"A\xE7\xF5es de repara\xE7\xE3o por danos materiais e morais.",category:"Civil",icon:"Gavel"},{title:"Direito do Consumidor",description:"Defesa contra pr\xE1ticas abusivas e defeitos.",category:"Civil",icon:"ShoppingBag"},{title:"Consultoria C\xEDvel",description:"Orienta\xE7\xE3o preventiva e an\xE1lise de riscos.",category:"Civil",icon:"BookOpen"},{title:"Acordos Extrajudiciais",description:"Resolu\xE7\xE3o de conflitos de forma amig\xE1vel.",category:"Civil",icon:"Handshake"},{title:"Planejamento Patrimonial",description:"Organiza\xE7\xE3o e prote\xE7\xE3o de bens e heran\xE7a.",category:"Civil",icon:"Briefcase"}];for(let r of e)await Eo.createService(r);console.log("Database seeded with services.")}}async function Ow(t,e){return await lq(),e.get(Nw.services.list.path,async(r,n)=>{let i=await Eo.getServices();n.json(i)}),t}var jw=Qn(Mu(),1),Iw=Qn(require("fs"),1),Fd=Qn(require("path"),1);function Rw(t){let e=Fd.default.resolve(__dirname,"public");if(!Iw.default.existsSync(e))throw new Error(`Could not find the build directory: ${e}, make sure to build the client first`);t.use(jw.default.static(e)),t.use("*",(r,n)=>{n.sendFile(Fd.default.resolve(e,"index.html"))})}var Mw=require("http"),Fr=(0,To.default)(),Dw=(0,Mw.createServer)(Fr);Fr.use(To.default.json({verify:(t,e,r)=>{t.rawBody=r}}));Fr.use(To.default.urlencoded({extended:!1}));function Bd(t,e="express"){let r=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0});console.log(`${r} [${e}] ${t}`)}Fr.use((t,e,r)=>{let n=Date.now(),i=t.path,a,s=e.json;e.json=function(o,...u){return a=o,s.apply(e,[o,...u])},e.on("finish",()=>{let o=Date.now()-n;if(i.startsWith("/api")){let u=`${t.method} ${i} ${e.statusCode} in ${o}ms`;a&&(u+=` :: ${JSON.stringify(a)}`),Bd(u)}}),r()});(async()=>{await Ow(Dw,Fr),Fr.use((e,r,n,i)=>{let a=e.status||e.statusCode||500,s=e.message||"Internal Server Error";throw n.status(a).json({message:s}),e}),Rw(Fr);let t=parseInt(process.env.PORT||"5000",10);Dw.listen({port:t,host:"0.0.0.0",reusePort:!0},()=>{Bd(`serving on port ${t}`)})})();0&&(module.exports={log});
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/app/dist/index.cjs:70:99269)
    at Module._compile (node:internal/modules/cjs/loader:1706:14)
    at Object..js (node:internal/modules/cjs/loader:1839:10)
    at Module.load (node:internal/modules/cjs/loader:1441:32)
    at Function._load (node:internal/modules/cjs/loader:1263:12)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:237:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.21.1
npm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/app/dist/index.cjs:70